{"version":3,"file":"index.js","sources":["../src/Citations.tsx","../src/PresenterNotes.tsx","../node_modules/lodash/_arrayPush.js","../node_modules/lodash/_freeGlobal.js","../node_modules/lodash/_root.js","../node_modules/lodash/_Symbol.js","../node_modules/lodash/_getRawTag.js","../node_modules/lodash/_objectToString.js","../node_modules/lodash/_baseGetTag.js","../node_modules/lodash/isObjectLike.js","../node_modules/lodash/_baseIsArguments.js","../node_modules/lodash/isArguments.js","../node_modules/lodash/isArray.js","../node_modules/lodash/_isFlattenable.js","../node_modules/lodash/_baseFlatten.js","../node_modules/lodash/flattenDeep.js","../node_modules/babel-plugin-transform-async-to-promises/helpers.js","../src/utils.ts","../src/lib/morph.ts","../src/AnimationEditor.tsx","../src/Morph.tsx","../src/staticAnalysis.ts","../src/Presentation.tsx","../src/Show.tsx","../src/themes/modern/index.tsx","../src/AnimateSVG.tsx","../src/LaTeX.tsx","../src/MObject.tsx","../src/Portal.tsx","../src/timeline.ts","../src/index.ts"],"sourcesContent":["import React, { useEffect, useState, useContext } from 'react'\n\nimport Citation from 'citation-js'\n\n/* global fetch */\n\nexport type CitationMap = { [key: string]: number }\ntype Bibliography = {\n  label: string\n}[]\n\nexport interface CitationContextInterface {\n  citationMap: CitationMap\n  bibliography: Bibliography | null\n}\n\nexport const CitationContext = React.createContext<CitationContextInterface | null>(\n  null\n)\n\ntype CitationProviderProps = {\n  bibUrl?: string\n  citationMap: CitationMap\n  children: React.ReactNode\n}\n\nexport function CitationProvider({\n  bibUrl,\n  citationMap,\n  children\n}: CitationProviderProps): React.ReactElement {\n  const [bibliography, setBibliography] = useState<Bibliography | null>(null)\n\n  useEffect(() => {\n    ;(async () => {\n      if (!bibUrl) {\n        return\n      }\n      const text = await fetch(bibUrl).then((res) => res.text())\n      const result = Citation.parse.bibtex.text(text)\n      setBibliography(result)\n    })()\n  }, [])\n\n  return (\n    <CitationContext.Provider\n      value={{\n        bibliography,\n        citationMap\n      }}\n    >\n      {children}\n    </CitationContext.Provider>\n  )\n}\n\ntype CiteRenderFunction = (arg: {\n  text: string | null\n  number: string | number | null\n}) => React.ReactElement\n\ntype RenderCiteProps = {\n  id: string\n  render: CiteRenderFunction\n}\n\ntype BibliographyRenderFunction = (\n  items: { id: string; n: number; html: string }[]\n) => React.ReactElement\n\nexport function RenderCite({\n  id,\n  render\n}: RenderCiteProps): React.ReactElement {\n  const { citationMap = {}, bibliography } = useContext(CitationContext) || {}\n\n  return render({\n    text: bibliography\n      ? new Citation(bibliography.find((e) => e.label === id)).format(\n          'bibliography',\n          {\n            format: 'text',\n            template: 'apa',\n            lang: 'en-US'\n          }\n        )\n      : null,\n    number:\n      bibliography && !bibliography.find((e) => e.label === id)\n        ? `?? ${id}`\n        : citationMap[id] || null\n  })\n}\n\nexport function RenderBibliography({\n  render\n}: {\n  render: BibliographyRenderFunction\n}): React.ReactElement {\n  const { citationMap = {}, bibliography = [] } =\n    useContext(CitationContext) || {}\n  // TODO: Slide header should work here!\n\n  const sortedEntries = Object.entries(citationMap).sort((a, b) => a[1] - b[1])\n\n  if (!bibliography) return render([])\n  return render(\n    sortedEntries.map(([id, n]) => {\n      const entry = bibliography.find((e) => e.label === id)\n      const html = new Citation(entry).format('bibliography', {\n        format: 'html',\n        template: 'apa',\n        lang: 'en-US'\n      })\n      return { id, n, html }\n    })\n  )\n}\n","import React from 'react'\n\n// The presenter notes get picked up by staticAnalysis.js and it's children get rendered elsewhere\nexport default function Notes(): React.ReactNode {\n  return <div />\n}\n","/**\n * Appends the elements of `values` to `array`.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {Array} values The values to append.\n * @returns {Array} Returns `array`.\n */\nfunction arrayPush(array, values) {\n  var index = -1,\n      length = values.length,\n      offset = array.length;\n\n  while (++index < length) {\n    array[offset + index] = values[index];\n  }\n  return array;\n}\n\nmodule.exports = arrayPush;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n","var root = require('./_root');\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nmodule.exports = Symbol;\n","var Symbol = require('./_Symbol');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nmodule.exports = getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n","var Symbol = require('./_Symbol'),\n    getRawTag = require('./_getRawTag'),\n    objectToString = require('./_objectToString');\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nmodule.exports = baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]';\n\n/**\n * The base implementation of `_.isArguments`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n */\nfunction baseIsArguments(value) {\n  return isObjectLike(value) && baseGetTag(value) == argsTag;\n}\n\nmodule.exports = baseIsArguments;\n","var baseIsArguments = require('./_baseIsArguments'),\n    isObjectLike = require('./isObjectLike');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nvar isArguments = baseIsArguments(function() { return arguments; }()) ? baseIsArguments : function(value) {\n  return isObjectLike(value) && hasOwnProperty.call(value, 'callee') &&\n    !propertyIsEnumerable.call(value, 'callee');\n};\n\nmodule.exports = isArguments;\n","/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nmodule.exports = isArray;\n","var Symbol = require('./_Symbol'),\n    isArguments = require('./isArguments'),\n    isArray = require('./isArray');\n\n/** Built-in value references. */\nvar spreadableSymbol = Symbol ? Symbol.isConcatSpreadable : undefined;\n\n/**\n * Checks if `value` is a flattenable `arguments` object or array.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is flattenable, else `false`.\n */\nfunction isFlattenable(value) {\n  return isArray(value) || isArguments(value) ||\n    !!(spreadableSymbol && value && value[spreadableSymbol]);\n}\n\nmodule.exports = isFlattenable;\n","var arrayPush = require('./_arrayPush'),\n    isFlattenable = require('./_isFlattenable');\n\n/**\n * The base implementation of `_.flatten` with support for restricting flattening.\n *\n * @private\n * @param {Array} array The array to flatten.\n * @param {number} depth The maximum recursion depth.\n * @param {boolean} [predicate=isFlattenable] The function invoked per iteration.\n * @param {boolean} [isStrict] Restrict to values that pass `predicate` checks.\n * @param {Array} [result=[]] The initial result value.\n * @returns {Array} Returns the new flattened array.\n */\nfunction baseFlatten(array, depth, predicate, isStrict, result) {\n  var index = -1,\n      length = array.length;\n\n  predicate || (predicate = isFlattenable);\n  result || (result = []);\n\n  while (++index < length) {\n    var value = array[index];\n    if (depth > 0 && predicate(value)) {\n      if (depth > 1) {\n        // Recursively flatten arrays (susceptible to call stack limits).\n        baseFlatten(value, depth - 1, predicate, isStrict, result);\n      } else {\n        arrayPush(result, value);\n      }\n    } else if (!isStrict) {\n      result[result.length] = value;\n    }\n  }\n  return result;\n}\n\nmodule.exports = baseFlatten;\n","var baseFlatten = require('./_baseFlatten');\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/**\n * Recursively flattens `array`.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Array\n * @param {Array} array The array to flatten.\n * @returns {Array} Returns the new flattened array.\n * @example\n *\n * _.flattenDeep([1, [2, [3, [4]], 5]]);\n * // => [1, 2, 3, 4, 5]\n */\nfunction flattenDeep(array) {\n  var length = array == null ? 0 : array.length;\n  return length ? baseFlatten(array, INFINITY) : [];\n}\n\nmodule.exports = flattenDeep;\n","// A type of promise-like that resolves synchronously and supports only one observer\nexport const _Pact = /*#__PURE__*/(function() {\n\tfunction _Pact() {}\n\t_Pact.prototype.then = function(onFulfilled, onRejected) {\n\t\tconst result = new _Pact();\n\t\tconst state = this.s;\n\t\tif (state) {\n\t\t\tconst callback = state & 1 ? onFulfilled : onRejected;\n\t\t\tif (callback) {\n\t\t\t\ttry {\n\t\t\t\t\t_settle(result, 1, callback(this.v));\n\t\t\t\t} catch (e) {\n\t\t\t\t\t_settle(result, 2, e);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t} else {\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}\n\t\tthis.o = function(_this) {\n\t\t\ttry {\n\t\t\t\tconst value = _this.v;\n\t\t\t\tif (_this.s & 1) {\n\t\t\t\t\t_settle(result, 1, onFulfilled ? onFulfilled(value) : value);\n\t\t\t\t} else if (onRejected) {\n\t\t\t\t\t_settle(result, 1, onRejected(value));\n\t\t\t\t} else {\n\t\t\t\t\t_settle(result, 2, value);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t_settle(result, 2, e);\n\t\t\t}\n\t\t};\n\t\treturn result;\n\t}\n\treturn _Pact;\n})();\n\n// Settles a pact synchronously\nexport function _settle(pact, state, value) {\n\tif (!pact.s) {\n\t\tif (value instanceof _Pact) {\n\t\t\tif (value.s) {\n\t\t\t\tif (state & 1) {\n\t\t\t\t\tstate = value.s;\n\t\t\t\t}\n\t\t\t\tvalue = value.v;\n\t\t\t} else {\n\t\t\t\tvalue.o = _settle.bind(null, pact, state);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tif (value && value.then) {\n\t\t\tvalue.then(_settle.bind(null, pact, state), _settle.bind(null, pact, 2));\n\t\t\treturn;\n\t\t}\n\t\tpact.s = state;\n\t\tpact.v = value;\n\t\tconst observer = pact.o;\n\t\tif (observer) {\n\t\t\tobserver(pact);\n\t\t}\n\t}\n}\n\nexport function _isSettledPact(thenable) {\n\treturn thenable instanceof _Pact && thenable.s & 1;\n}\n\n// Converts argument to a function that always returns a Promise\nexport function _async(f) {\n\treturn function() {\n\t\tfor (var args = [], i = 0; i < arguments.length; i++) {\n\t\t\targs[i] = arguments[i];\n\t\t}\n\t\ttry {\n\t\t\treturn Promise.resolve(f.apply(this, args));\n\t\t} catch(e) {\n\t\t\treturn Promise.reject(e);\n\t\t}\n\t}\n}\n\n// Awaits on a value that may or may not be a Promise (equivalent to the await keyword in ES2015, with continuations passed explicitly)\nexport function _await(value, then, direct) {\n\tif (direct) {\n\t\treturn then ? then(value) : value;\n\t}\n\tif (!value || !value.then) {\n\t\tvalue = Promise.resolve(value);\n\t}\n\treturn then ? value.then(then) : value;\n}\n\n// Awaits on a value that may or may not be a Promise, then ignores it\nexport function _awaitIgnored(value, direct) {\n\tif (!direct) {\n\t\treturn value && value.then ? value.then(_empty) : Promise.resolve();\n\t}\n}\n\n// Proceeds after a value has resolved, or proceeds immediately if the value is not thenable\nexport function _continue(value, then) {\n\treturn value && value.then ? value.then(then) : then(value);\n}\n\n// Proceeds after a value has resolved, or proceeds immediately if the value is not thenable\nexport function _continueIgnored(value) {\n\tif (value && value.then) {\n\t\treturn value.then(_empty);\n\t}\n}\n\n// Asynchronously iterate through an object that has a length property, passing the index as the first argument to the callback (even as the length property changes)\nexport function _forTo(array, body, check) {\n\tvar i = -1, pact, reject;\n\tfunction _cycle(result) {\n\t\ttry {\n\t\t\twhile (++i < array.length && (!check || !check())) {\n\t\t\t\tresult = body(i);\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.then(_cycle, reject || (reject = _settle.bind(null, pact = new _Pact(), 2)));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (pact) {\n\t\t\t\t_settle(pact, 1, result);\n\t\t\t} else {\n\t\t\t\tpact = result;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t_settle(pact || (pact = new _Pact()), 2, e);\n\t\t}\n\t}\n\t_cycle();\n\treturn pact;\n}\n\n// Asynchronously iterate through an object's properties (including properties inherited from the prototype)\n// Uses a snapshot of the object's properties\nexport function _forIn(target, body, check) {\n\tvar keys = [];\n\tfor (var key in target) {\n\t\tkeys.push(key);\n\t}\n\treturn _forTo(keys, function(i) { return body(keys[i]); }, check);\n}\n\n// Asynchronously iterate through an object's own properties (excluding properties inherited from the prototype)\n// Uses a snapshot of the object's properties\nexport function _forOwn(target, body, check) {\n\tvar keys = [];\n\tfor (var key in target) {\n\t\tif (Object.prototype.hasOwnProperty.call(target, key)) {\n\t\t\tkeys.push(key);\n\t\t}\n\t}\n\treturn _forTo(keys, function(i) { return body(keys[i]); }, check);\n}\n\nexport const _iteratorSymbol = /*#__PURE__*/ typeof Symbol !== \"undefined\" ? (Symbol.iterator || (Symbol.iterator = Symbol(\"Symbol.iterator\"))) : \"@@iterator\";\n\n// Asynchronously iterate through an object's values\n// Uses for...of if the runtime supports it, otherwise iterates until length on a copy\nexport function _forOf(target, body, check) {\n\tif (typeof target[_iteratorSymbol] === \"function\") {\n\t\tvar iterator = target[_iteratorSymbol](), step, pact, reject;\n\t\tfunction _cycle(result) {\n\t\t\ttry {\n\t\t\t\twhile (!(step = iterator.next()).done && (!check || !check())) {\n\t\t\t\t\tresult = body(step.value);\n\t\t\t\t\tif (result && result.then) {\n\t\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult.then(_cycle, reject || (reject = _settle.bind(null, pact = new _Pact(), 2)));\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (pact) {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t} else {\n\t\t\t\t\tpact = result;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t_settle(pact || (pact = new _Pact()), 2, e);\n\t\t\t}\n\t\t}\n\t\t_cycle();\n\t\tif (iterator.return) {\n\t\t\tvar _fixup = function(value) {\n\t\t\t\ttry {\n\t\t\t\t\tif (!step.done) {\n\t\t\t\t\t\titerator.return();\n\t\t\t\t\t}\n\t\t\t\t} catch(e) {\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t}\n\t\t\tif (pact && pact.then) {\n\t\t\t\treturn pact.then(_fixup, function(e) {\n\t\t\t\t\tthrow _fixup(e);\n\t\t\t\t});\n\t\t\t}\n\t\t\t_fixup();\n\t\t}\n\t\treturn pact;\n\t}\n\t// No support for Symbol.iterator\n\tif (!(\"length\" in target)) {\n\t\tthrow new TypeError(\"Object is not iterable\");\n\t}\n\t// Handle live collections properly\n\tvar values = [];\n\tfor (var i = 0; i < target.length; i++) {\n\t\tvalues.push(target[i]);\n\t}\n\treturn _forTo(values, function(i) { return body(values[i]); }, check);\n}\n\nexport const _asyncIteratorSymbol = /*#__PURE__*/ typeof Symbol !== \"undefined\" ? (Symbol.asyncIterator || (Symbol.asyncIterator = Symbol(\"Symbol.asyncIterator\"))) : \"@@asyncIterator\";\n\n// Asynchronously iterate on a value using it's async iterator if present, or its synchronous iterator if missing\nexport function _forAwaitOf(target, body, check) {\n\tif (typeof target[_asyncIteratorSymbol] === \"function\") {\n\t\tvar pact = new _Pact();\n\t\tvar iterator = target[_asyncIteratorSymbol]();\n\t\titerator.next().then(_resumeAfterNext).then(void 0, _reject);\n\t\treturn pact;\n\t\tfunction _resumeAfterBody(result) {\n\t\t\tif (check && check()) {\n\t\t\t\treturn _settle(pact, 1, iterator.return ? iterator.return().then(function() { return result; }) : result);\n\t\t\t}\n\t\t\titerator.next().then(_resumeAfterNext).then(void 0, _reject);\n\t\t}\n\t\tfunction _resumeAfterNext(step) {\n\t\t\tif (step.done) {\n\t\t\t\t_settle(pact, 1);\n\t\t\t} else {\n\t\t\t\tPromise.resolve(body(step.value)).then(_resumeAfterBody).then(void 0, _reject);\n\t\t\t}\n\t\t}\n\t\tfunction _reject(error) {\n\t\t\t_settle(pact, 2, iterator.return ? iterator.return().then(function() { return error; }) : error);\n\t\t}\n\t}\n\treturn Promise.resolve(_forOf(target, function(value) { return Promise.resolve(value).then(body); }, check));\n}\n\n// Asynchronously implement a generic for loop\nexport function _for(test, update, body) {\n\tvar stage;\n\tfor (;;) {\n\t\tvar shouldContinue = test();\n\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\tshouldContinue = shouldContinue.v;\n\t\t}\n\t\tif (!shouldContinue) {\n\t\t\treturn result;\n\t\t}\n\t\tif (shouldContinue.then) {\n\t\t\tstage = 0;\n\t\t\tbreak;\n\t\t}\n\t\tvar result = body();\n\t\tif (result && result.then) {\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.s;\n\t\t\t} else {\n\t\t\t\tstage = 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (update) {\n\t\t\tvar updateValue = update();\n\t\t\tif (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n\t\t\t\tstage = 2;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tvar pact = new _Pact();\n\tvar reject = _settle.bind(null, pact, 2);\n\t(stage === 0 ? shouldContinue.then(_resumeAfterTest) : stage === 1 ? result.then(_resumeAfterBody) : updateValue.then(_resumeAfterUpdate)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterBody(value) {\n\t\tresult = value;\n\t\tdo {\n\t\t\tif (update) {\n\t\t\t\tupdateValue = update();\n\t\t\t\tif (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n\t\t\t\t\tupdateValue.then(_resumeAfterUpdate).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tshouldContinue = test();\n\t\t\tif (!shouldContinue || (_isSettledPact(shouldContinue) && !shouldContinue.v)) {\n\t\t\t\t_settle(pact, 1, result);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.v;\n\t\t\t}\n\t\t} while (!result || !result.then);\n\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t}\n\tfunction _resumeAfterTest(shouldContinue) {\n\t\tif (shouldContinue) {\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t} else {\n\t\t\t\t_resumeAfterBody(result);\n\t\t\t}\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n\tfunction _resumeAfterUpdate() {\n\t\tif (shouldContinue = test()) {\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t} else {\n\t\t\t\t_resumeAfterTest(shouldContinue);\n\t\t\t}\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n}\n\n// Asynchronously implement a do ... while loop\nexport function _do(body, test) {\n\tvar awaitBody;\n\tdo {\n\t\tvar result = body();\n\t\tif (result && result.then) {\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.v;\n\t\t\t} else {\n\t\t\t\tawaitBody = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tvar shouldContinue = test();\n\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\tshouldContinue = shouldContinue.v;\n\t\t}\n\t\tif (!shouldContinue) {\n\t\t\treturn result;\n\t\t}\n\t} while (!shouldContinue.then);\n\tconst pact = new _Pact();\n\tconst reject = _settle.bind(null, pact, 2);\n\t(awaitBody ? result.then(_resumeAfterBody) : shouldContinue.then(_resumeAfterTest)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterBody(value) {\n\t\tresult = value;\n\t\tfor (;;) {\n\t\t\tshouldContinue = test();\n\t\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\t\tshouldContinue = shouldContinue.v;\n\t\t\t}\n\t\t\tif (!shouldContinue) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\tresult = result.v;\n\t\t\t\t} else {\n\t\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t_settle(pact, 1, result);\n\t}\n\tfunction _resumeAfterTest(shouldContinue) {\n\t\tif (shouldContinue) {\n\t\t\tdo {\n\t\t\t\tresult = body();\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tshouldContinue = test();\n\t\t\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\t\t\tshouldContinue = shouldContinue.v;\n\t\t\t\t}\n\t\t\t\tif (!shouldContinue) {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} while (!shouldContinue.then);\n\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n}\n\n// Asynchronously implement a switch statement\nexport function _switch(discriminant, cases) {\n\tvar dispatchIndex = -1;\n\tvar awaitBody;\n\touter: {\n\t\tfor (var i = 0; i < cases.length; i++) {\n\t\t\tvar test = cases[i][0];\n\t\t\tif (test) {\n\t\t\t\tvar testValue = test();\n\t\t\t\tif (testValue && testValue.then) {\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\t\t\t\tif (testValue === discriminant) {\n\t\t\t\t\tdispatchIndex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Found the default case, set it as the pending dispatch case\n\t\t\t\tdispatchIndex = i;\n\t\t\t}\n\t\t}\n\t\tif (dispatchIndex !== -1) {\n\t\t\tdo {\n\t\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\t\twhile (!body) {\n\t\t\t\t\tdispatchIndex++;\n\t\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t\t}\n\t\t\t\tvar result = body();\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tawaitBody = true;\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\t\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\t\tdispatchIndex++;\n\t\t\t} while (fallthroughCheck && !fallthroughCheck());\n\t\t\treturn result;\n\t\t}\n\t}\n\tconst pact = new _Pact();\n\tconst reject = _settle.bind(null, pact, 2);\n\t(awaitBody ? result.then(_resumeAfterBody) : testValue.then(_resumeAfterTest)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterTest(value) {\n\t\tfor (;;) {\n\t\t\tif (value === discriminant) {\n\t\t\t\tdispatchIndex = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (++i === cases.length) {\n\t\t\t\tif (dispatchIndex !== -1) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttest = cases[i][0];\n\t\t\tif (test) {\n\t\t\t\tvalue = test();\n\t\t\t\tif (value && value.then) {\n\t\t\t\t\tvalue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdispatchIndex = i;\n\t\t\t}\n\t\t}\n\t\tdo {\n\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\twhile (!body) {\n\t\t\t\tdispatchIndex++;\n\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t}\n\t\t\tvar result = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\tdispatchIndex++;\n\t\t} while (fallthroughCheck && !fallthroughCheck());\n\t\t_settle(pact, 1, result);\n\t}\n\tfunction _resumeAfterBody(result) {\n\t\tfor (;;) {\n\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\tif (!fallthroughCheck || fallthroughCheck()) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdispatchIndex++;\n\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\twhile (!body) {\n\t\t\t\tdispatchIndex++;\n\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t_settle(pact, 1, result);\n\t}\n}\n\n// Asynchronously call a function and pass the result to explicitly passed continuations\nexport function _call(body, then, direct) {\n\tif (direct) {\n\t\treturn then ? then(body()) : body();\n\t}\n\ttry {\n\t\tvar result = Promise.resolve(body());\n\t\treturn then ? result.then(then) : result;\n\t} catch (e) {\n\t\treturn Promise.reject(e);\n\t}\n}\n\n// Asynchronously call a function and swallow the result\nexport function _callIgnored(body, direct) {\n\treturn _call(body, _empty, direct);\n}\n\n// Asynchronously call a function and pass the result to explicitly passed continuations\nexport function _invoke(body, then) {\n\tvar result = body();\n\tif (result && result.then) {\n\t\treturn result.then(then);\n\t}\n\treturn then(result);\n}\n\n// Asynchronously call a function and swallow the result\nexport function _invokeIgnored(body) {\n\tvar result = body();\n\tif (result && result.then) {\n\t\treturn result.then(_empty);\n\t}\n}\n\n// Asynchronously call a function and send errors to recovery continuation\nexport function _catch(body, recover) {\n\ttry {\n\t\tvar result = body();\n\t} catch(e) {\n\t\treturn recover(e);\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(void 0, recover);\n\t}\n\treturn result;\n}\n\n// Asynchronously await a promise and pass the result to a finally continuation\nexport function _finallyRethrows(body, finalizer) {\n\ttry {\n\t\tvar result = body();\n\t} catch (e) {\n\t\treturn finalizer(true, e);\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n\t}\n\treturn finalizer(false, result);\n}\n\n// Asynchronously await a promise and invoke a finally continuation that always overrides the result\nexport function _finally(body, finalizer) {\n\ttry {\n\t\tvar result = body();\n\t} catch (e) {\n\t\treturn finalizer();\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(finalizer, finalizer);\n\t}\n\treturn finalizer();\n}\n\n// Rethrow or return a value from a finally continuation\nexport function _rethrow(thrown, value) {\n\tif (thrown)\n\t\tthrow value;\n\treturn value;\n}\n\n// Empty function to implement break and other control flow that ignores asynchronous results\nexport function _empty() {\n}\n\n// Sentinel value for early returns in generators \nexport const _earlyReturn = /*#__PURE__*/ {};\n\n// Asynchronously call a function and send errors to recovery continuation, skipping early returns\nexport function _catchInGenerator(body, recover) {\n\treturn _catch(body, function(e) {\n\t\tif (e === _earlyReturn) {\n\t\t\tthrow e;\n\t\t}\n\t\treturn recover(e);\n\t});\n}\n\n// Asynchronous generator class; accepts the entrypoint of the generator, to which it passes itself when the generator should start\nexport const _AsyncGenerator = /*#__PURE__*/(function() {\n\tfunction _AsyncGenerator(entry) {\n\t\tthis._entry = entry;\n\t\tthis._pact = null;\n\t\tthis._resolve = null;\n\t\tthis._return = null;\n\t\tthis._promise = null;\n\t}\n\n\tfunction _wrapReturnedValue(value) {\n\t\treturn { value: value, done: true };\n\t}\n\tfunction _wrapYieldedValue(value) {\n\t\treturn { value: value, done: false };\n\t}\n\n\t_AsyncGenerator.prototype._yield = function(value) {\n\t\t// Yield the value to the pending next call\n\t\tthis._resolve(value && value.then ? value.then(_wrapYieldedValue) : _wrapYieldedValue(value));\n\t\t// Return a pact for an upcoming next/return/throw call\n\t\treturn this._pact = new _Pact();\n\t};\n\t_AsyncGenerator.prototype.next = function(value) {\n\t\t// Advance the generator, starting it if it has yet to be started\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tconst _entry = _this._entry;\n\t\t\t\tif (_entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the next call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Start the generator\n\t\t\t\t_this._entry = null;\n\t\t\t\t_this._resolve = resolve;\n\t\t\t\tfunction returnValue(value) {\n\t\t\t\t\t_this._resolve(value && value.then ? value.then(_wrapReturnedValue) : _wrapReturnedValue(value));\n\t\t\t\t\t_this._pact = null;\n\t\t\t\t\t_this._resolve = null;\n\t\t\t\t}\n\t\t\t\tvar result = _entry(_this);\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tresult.then(returnValue, function(error) {\n\t\t\t\t\t\tif (error === _earlyReturn) {\n\t\t\t\t\t\t\treturnValue(_this._return);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst pact = new _Pact();\n\t\t\t\t\t\t\t_this._resolve(pact);\n\t\t\t\t\t\t\t_this._pact = null;\n\t\t\t\t\t\t\t_this._resolve = null;\n\t\t\t\t\t\t\t_resolve(pact, 2, error);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturnValue(result);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Generator is started and a yield expression is pending, settle it\n\t\t\t\t_this._pact = null;\n\t\t\t\t_this._resolve = resolve;\n\t\t\t\t_settle(_pact, 1, value);\n\t\t\t}\n\t\t});\n\t};\n\t_AsyncGenerator.prototype.return = function(value) {\n\t\t// Early return from the generator if started, otherwise abandons the generator\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tif (_this._entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the return call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Generator is not started, abandon it and return the specified value\n\t\t\t\t_this._entry = null;\n\t\t\t\treturn resolve(value && value.then ? value.then(_wrapReturnedValue) : _wrapReturnedValue(value));\n\t\t\t}\n\t\t\t// Settle the yield expression with a rejected \"early return\" value\n\t\t\t_this._return = value;\n\t\t\t_this._resolve = resolve;\n\t\t\t_this._pact = null;\n\t\t\t_settle(_pact, 2, _earlyReturn);\n\t\t});\n\t};\n\t_AsyncGenerator.prototype.throw = function(error) {\n\t\t// Inject an exception into the pending yield expression\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve, reject) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tif (_this._entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the throw call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Generator is not started, abandon it and return a rejected Promise containing the error\n\t\t\t\t_this._entry = null;\n\t\t\t\treturn reject(error);\n\t\t\t}\n\t\t\t// Settle the yield expression with the value as a rejection\n\t\t\t_this._resolve = resolve;\n\t\t\t_this._pact = null;\n\t\t\t_settle(_pact, 2, error);\n\t\t});\n\t};\n\n\t_AsyncGenerator.prototype[_asyncIteratorSymbol] = function() {\n\t\treturn this;\n\t};\n\t\n\treturn _AsyncGenerator;\n})();\n","import memoize from 'memoizee'\n\nimport { pathParse, serializePath } from 'svg-path-parse'\n\nimport { useEffect, useRef, useState } from 'react'\n\nimport { LaTeXSVGData } from './types'\n\nexport const range = (n: number): number[] => Array.from(Array(n).keys())\n\n/* global fetch */\n\nexport const hashString = function (str: string): number {\n  let hash = 0\n  let i: number\n  let chr: number\n  if (str.length === 0) return hash\n  for (i = 0; i < str.length; i++) {\n    chr = str.charCodeAt(i)\n    hash = (hash << 5) - hash + chr\n    hash |= 0 // Convert to 32bit integer\n  }\n  return hash\n}\n\nconst queryParameters = (obj: { [key: string]: string }): string => {\n  return Object.entries(obj)\n    .map(([key, value]) => `${key}=${encodeURIComponent(value)}`)\n    .join('&')\n}\n\nconst cacheBust = '8'\nexport const LaTeX = {\n  _preamble: ``,\n  _host: `http://${window.location.hostname}:3001`,\n  getHost: (): string => LaTeX._host,\n  setHost: (h: string): void => {\n    LaTeX._host = h\n  },\n  getPreamble: (): string => LaTeX._preamble,\n  setPreamble: (p: string): void => {\n    LaTeX._preamble = normalizeLaTeXPreamble(p)\n  },\n  fetchSVG: async (tex: string): Promise<string> => {\n    const result = await fetch(\n      `${LaTeX.getHost()}/latex?${queryParameters({\n        cachebust: cacheBust,\n        tex: tex,\n        preamble: LaTeX.getPreamble()\n      })}`\n    )\n    if (result.ok) {\n      return await result.text()\n    } else {\n      throw new Error(\"Couldn't compile LaTeX\")\n    }\n  }\n}\n\nfunction normalizeLaTeXPreamble(preamble: string) {\n  return preamble\n    .split('\\n')\n    .map((line) => line.trim())\n    .filter((line) => line !== '')\n    .join('\\n')\n}\n\nfunction elementToPath(child: SVGElement, transform = ''): string | null {\n  if (!child.ownerSVGElement) {\n    throw new Error('Found a child without ownerSVGElement')\n  }\n  const svg: SVGSVGElement = child.ownerSVGElement\n  if (child.tagName === 'use') {\n    const offsetX = parseFloat(child.getAttribute('x') || '0')\n    const offsetY = parseFloat(child.getAttribute('y') || '0')\n\n    const id = child.getAttribute('xlink:href')\n    if (!id) {\n      throw new Error('Found a use tag without an id.')\n    }\n\n    const element: SVGElement | null = svg.querySelector(id)\n    if (!element) {\n      console.error(\n        'I found a use tag with id',\n        id,\n        child,\n        \"but I didn't find a definition in the svg: \",\n        svg\n      )\n      return null\n    }\n    if (element.tagName === 'path') {\n      const path = element.getAttribute('d')\n      const { err, segments, type } = pathParse(path).relNormalize({\n        transform: `translate(${offsetX}, ${offsetY}) ${transform}`.trim()\n      })\n\n      const newPath = serializePath({ err, segments: segments, type })\n\n      return newPath\n    } else if (element.tagName === 'use') {\n      const tr = element.getAttribute('transform') || ''\n      return elementToPath(\n        element,\n        `translate(${offsetX}, ${offsetY}) ${tr}`.trim()\n      )\n    } else {\n      console.error('Unrecognized use of element', element)\n      return null\n    }\n  }\n\n  if (child.tagName === 'rect') {\n    const x = +child.getAttribute('x')!\n    const y = +child.getAttribute('y')!\n    const width = +child.getAttribute('width')!\n    const height = +child.getAttribute('height')!\n\n    const pathData =\n      'M' + x + ' ' + y + 'H' + (x + width) + 'V' + (y + height) + 'H' + x + 'z'\n    return pathData\n  }\n  // TODO polyline or something like that\n  console.error('Unrecognized:', child)\n  return null\n}\n\nfunction groupIdFromElement(element: SVGElement): string {\n  const fill = element.getAttribute('fill')\n  if (!fill) {\n    return 'g0'\n  }\n  return 'g' + fill.slice(1)\n}\n\nfunction svgToGroupedPaths(svg: SVGSVGElement) {\n  const byGroupId: { [key: string]: string } = {}\n\n  for (const child of Array.from(svg.getElementById('page1').children)) {\n    const id = groupIdFromElement(child as SVGElement)\n    let path: string | null\n    if (child.tagName === 'g') {\n      path = Array.from(child.children)\n        .map((subchild) => elementToPath(subchild as SVGElement))\n        .filter(Boolean)\n        .join(' ')\n    } else {\n      path = elementToPath(child as SVGElement)\n    }\n    if (!path) continue\n\n    if (!byGroupId[id]) {\n      byGroupId[id] = ''\n    }\n    byGroupId[id] += path\n  }\n\n  return byGroupId\n}\n\nfunction colorHash(str: string): string {\n  str = String(str)\n  let hash = 0\n  for (let i = 0; i < str.length; i++) {\n    hash = str.charCodeAt(i) + ((hash << 5) - hash)\n  }\n  let colour = ''\n  for (let i = 0; i < 3; i++) {\n    const value = (hash >> (i * 8)) & 0xff\n    colour += ('00' + value.toString(16)).substr(-2).toUpperCase()\n  }\n  return colour\n}\n\nexport const fetchLaTeXSvg = memoize(\n  async (tex: string): Promise<LaTeXSVGData | null> => {\n    console.log('compiling', tex)\n    tex = tex.replace(/\\\\g(\\d)/g, (_, p1) => `\\\\g{${colorHash(p1)}}`)\n    tex = tex.replace(/\\\\g\\{(.*?)\\}/g, (_, p1) => `\\\\g{${colorHash(p1)}}`)\n\n    // console.log('COMPILING', tex)\n    let text: string\n    try {\n      text = await LaTeX.fetchSVG(tex)\n    } catch (e) {\n      return null\n    }\n\n    const ele = document.createElement('div')\n    ele.innerHTML = text\n\n    const svg = ele.querySelector('svg')\n\n    if (!svg) {\n      throw new Error('Could not find SVG in compiled LaTeX')\n    }\n\n    const groups = svgToGroupedPaths(svg)\n\n    const width = svg.getAttribute('width')\n    const height = svg.getAttribute('height')\n    const viewBox = svg.getAttribute('viewBox')\n    if (!width || !height || !viewBox) {\n      throw new Error('Compiled LaTeX SVG has no height or width or viewBox')\n    }\n    return {\n      groups,\n      width: parseFloat(width.replace('pt', '')),\n      height: parseFloat(height.replace('pt', '')),\n      viewBox: viewBox.split(' ').map((s) => parseFloat(s))\n    }\n  }\n)\n\nexport function usePrevious<T>(value: T): T | undefined {\n  const ref = useRef<T>()\n  useEffect(() => {\n    ref.current = value\n  })\n  return ref.current\n}\n\n// Hook\nexport function useLocalStorage<T>(key: string, initialValue: T) {\n  // State to store our value\n  // Pass initial state function to useState so logic is only executed once\n  const [storedValue, setStoredValue] = useState<T>(() => {\n    try {\n      // Get from local storage by key\n      const item = window.localStorage.getItem(key)\n      // Parse stored json or if none return initialValue\n      return item ? JSON.parse(item) : initialValue\n    } catch (error) {\n      // If error also return initialValue\n      console.log(error)\n      return initialValue\n    }\n  })\n\n  // Return a wrapped version of useState's setter function that ...\n  // ... persists the new value to localStorage.\n  const setValue = (value: T | ((t: T) => T)) => {\n    try {\n      // Allow value to be a function so we have same API as useState\n      const valueToStore =\n        value instanceof Function ? value(storedValue) : value\n      // Save state\n      setStoredValue(valueToStore)\n      // Save to local storage\n      window.localStorage.setItem(key, JSON.stringify(valueToStore))\n    } catch (error) {\n      // A more advanced implementation would handle the error case\n      console.log(error)\n    }\n  }\n  return [storedValue, setValue] as const\n}\n","import { fetchLaTeXSvg } from '../utils'\n\n// import '../external/TweenMax.min'\nimport gsap from 'gsap'\nimport MorphSVGPlugin from 'gsap-bonus/MorphSVGPlugin'\nimport DrawSVGPlugin from 'gsap-bonus/DrawSVGPlugin'\n\nimport { LaTeXSVGData } from '../types'\n\ngsap.registerPlugin(MorphSVGPlugin, DrawSVGPlugin)\n\n// FIXME temp 'hack', should add colors={[...]} to <Morph>?\n\nfunction colorFromGroupId(id: string): string {\n  if (id === 'g0') return 'black'\n  return '#' + id.slice(1)\n}\n\nconst whiteListedColors = ['#00d56f']\n\nconst DEFAULT_TIMING = 0.4\n\nexport type SVGData = {\n  width: number\n  height: number\n  viewBox: number[]\n}\nexport async function animate(\n  svgEl: SVGSVGElement,\n  text: string,\n  replaceImediately = false,\n  TIMING: number = DEFAULT_TIMING,\n  setSvgData: (data: SVGData) => void = () => undefined\n): Promise<any[]> {\n  let data: LaTeXSVGData\n  if (text === '') {\n    data = {\n      groups: {},\n      width: 0,\n      height: 0,\n      viewBox: [0, 0, 0, 0]\n    }\n  } else {\n    data = await fetchLaTeXSvg(text)\n  }\n\n  if (!data) {\n    return []\n  }\n\n  const { groups: newPaths, width, height, viewBox } = data\n\n  // This should check if is unmounted\n  setSvgData({ width, height, viewBox })\n\n  const afterIds = Object.keys(newPaths)\n  const beforeIds = Array.from(svgEl.querySelectorAll('[id]')).map((e) => e.id)\n  const allIds = Array.from(new Set([...afterIds, ...beforeIds]))\n\n  return Promise.all(\n    allIds.map(async (id) => {\n      const shouldRemove = beforeIds.includes(id) && !afterIds.includes(id)\n      const isNew = afterIds.includes(id) && !beforeIds.includes(id)\n\n      if (shouldRemove) {\n        const element = svgEl.getElementById(id)\n        if (replaceImediately) {\n          element.remove()\n          return true\n        } else {\n          await gsap.to(element, {\n            duration: TIMING,\n            opacity: 0\n          })\n          element.remove()\n          return true\n        }\n      }\n\n      if (isNew) {\n        const path = document.createElementNS(\n          'http://www.w3.org/2000/svg',\n          'path'\n        )\n        path.id = id\n        path.setAttribute('d', newPaths[id])\n\n        const color = colorFromGroupId(id)\n        if (whiteListedColors.includes(color)) {\n          path.setAttribute('fill', color)\n        }\n\n        path.style.opacity = '0'\n        svgEl.appendChild(path)\n\n        if (replaceImediately) {\n          path.style.opacity = '1'\n          return true\n        } else {\n          await gsap.to(path, {\n            duration: TIMING,\n            opacity: 1\n          })\n          return true\n        }\n      }\n\n      // morphing\n      const element = svgEl.getElementById(id) as SVGElement\n\n      if (replaceImediately) {\n        element.setAttribute('d', newPaths[id])\n        element.style.opacity = '1'\n        return true\n      } else {\n        await gsap.to(element, {\n          duration: TIMING,\n          morphSVG: newPaths[id],\n          // TODO test if makes difference!\n          // type:\"rotational\",\n          opacity: 1\n        })\n        return true\n      }\n    })\n  )\n}\n","import React, { useEffect, useState, useMemo, useCallback } from 'react'\n\nimport { useLocalStorage } from './utils'\nimport Morph from './Morph'\n\nimport './AnimationEditor.css'\n// import localStorageData from './localStorage.json'\n\ntype Selection = [number, number, number]\n\ntype AnimationEditorProps = {\n  animations: { start: string; end: string }[]\n}\n\ntype Animation = {\n  startGroups: Selection[]\n  endGroups: Selection[]\n  start: string\n  end: string\n  index?: number\n}\n\ntype AnimationProps = {\n  colorIndex: number\n  setColorIndex: (arg: number) => void\n  animation: Animation\n  setAnimation: (arg: Animation) => void\n}\n\n/* global localStorage */\nconst allColors = [\n  '#D32F2F',\n  '#7B1FA2',\n  '#512DA8',\n  '#303F9F',\n  '#1976D2',\n  '#0288D1',\n  '#0097A7',\n  '#00796B',\n  '#388E3C',\n  '#689F38',\n  '#AFB42B',\n  '#FBC02D',\n  '#FFA000',\n  '#F57C00',\n  '#E64A19'\n]\n\nfunction convertToTeX(tex: string, selections: Selection[]) {\n  return (\n    tex\n      .split('')\n      .map((c, i) => {\n        /* eslint-disable @typescript-eslint/no-unused-vars */\n        const ending = selections.filter(([c, s, e]) => e === i)\n        const starting = selections\n          .filter(([_c, s, _e]) => s === i)\n          .sort((a, b) => b[2] - a[2]) // descending on `end`\n          .map(([c, s, e]) => c)\n\n        return (\n          ending.map(() => '}').join('') +\n          starting.map((col) => `\\\\g{${col + 1}}{`).join('') +\n          c\n        )\n      })\n      .join('') +\n    selections\n      .filter(([c, s, e]) => e === tex.length)\n      .map(() => '}')\n      .join('')\n  )\n}\n\nexport const lookupAnimationGroups = (() => {\n  // TODO: use hashmap?\n  return (start: string, end: string) => {\n    const data = JSON.parse(localStorage.animationGroups || '[]') as Animation[]\n    const result = data.find(({ start: s, end: e }) => {\n      return (start === s && end === e) || (start === e && end === s)\n    })\n\n    // no result found\n    if (!result) {\n      return [start, end]\n    }\n\n    if (result.start === start) {\n      // not reversed\n      return [\n        convertToTeX(result.start, result.startGroups),\n        convertToTeX(result.end, result.endGroups)\n      ]\n    } else {\n      // reversed\n      return [\n        convertToTeX(result.end, result.endGroups),\n        convertToTeX(result.start, result.startGroups)\n      ]\n    }\n  }\n})()\n\nexport default function AnimationEditor({\n  animations: playedAnimations\n}: AnimationEditorProps): React.ReactElement {\n  const [animations, setAnimations] = useLocalStorage<Animation[]>(\n    'animationGroups',\n    []\n  )\n  const [colorIndex, setColorIndex] = useState<number>(0)\n\n  const onKeyPress = (e: KeyboardEvent): void => {\n    try {\n      const i = parseInt(e.key, 10)\n      setColorIndex((i + 9) % 10)\n    } catch (e) {}\n  }\n\n  useEffect(() => {\n    window.addEventListener('keypress', onKeyPress)\n    return () => window.removeEventListener('keypress', onKeyPress)\n  }, [])\n\n  useEffect(() => {\n    const newOnes = playedAnimations\n      .filter((animation) => {\n        const animated = animations.find(\n          (a) =>\n            (animation.start === a.start && animation.end === a.end) ||\n            (animation.start === a.end && animation.end === a.start)\n        )\n        const inDataBase = !animated\n        return inDataBase\n      })\n      .map((anim) => ({\n        ...anim,\n        startGroups: [],\n        endGroups: []\n      }))\n\n    if (newOnes.length >= 1) {\n      setAnimations((animations) => [...animations, ...newOnes])\n    }\n  }, [animations, playedAnimations])\n\n  const animationsIShouldShow = useMemo(\n    () =>\n      (playedAnimations\n        .map((animation) => {\n          const index = animations.findIndex(\n            (a) =>\n              (animation.start === a.start && animation.end === a.end) ||\n              (animation.start === a.end && animation.end === a.start)\n          )\n\n          const a = animations[index]\n\n          if (!a) return null\n\n          return {\n            ...a,\n            start: '' + a.start,\n            end: '' + a.end,\n            index\n          } as Animation\n        })\n        .filter((a) => a !== null) as (Animation & { index: number })[]).filter(\n        (value, index, array) => {\n          return (\n            array.findIndex(\n              ({ start, end }) => value.start === start && value.end === end\n            ) === index\n          )\n        }\n      ),\n    [animations, playedAnimations]\n  )\n\n  return (\n    <div className='animation-editor'>\n      <div className='colors'>\n        {allColors.map((c, i) => (\n          <span\n            key={i}\n            className='color'\n            style={{\n              backgroundColor: c,\n              transform: colorIndex === i ? 'scale(1.4)' : 'scale(1)'\n            }}\n            onClick={() => setColorIndex(i)}\n          />\n        ))}\n      </div>\n      <style>{` .formula *::selection { background: ${allColors[colorIndex]} } `}</style>\n\n      <div className='animations'>\n        {animationsIShouldShow.map((animation) => {\n          const i = animation.index\n          return (\n            <Animation\n              key={animation.start + animation.end}\n              animation={animation}\n              setAnimation={(f: Animation) =>\n                setAnimations([\n                  ...animations.slice(0, i),\n                  f,\n                  ...animations.slice(i + 1)\n                ])\n              }\n              colorIndex={colorIndex}\n              setColorIndex={setColorIndex}\n            />\n          )\n        })}\n      </div>\n    </div>\n  )\n}\n\ntype Part = 'start' | 'end'\n\nfunction Animation({\n  colorIndex,\n  setColorIndex,\n  animation,\n  setAnimation\n}: AnimationProps) {\n  const handleSelection = useCallback(() => {\n    const sel = window.getSelection()\n\n    if (!sel) return\n\n    if (!sel.anchorNode || !sel.focusNode) return\n    try {\n      const sString = (sel.anchorNode?.parentNode as HTMLElement)?.dataset.index\n      const eString = (sel.focusNode?.parentNode as HTMLElement)?.dataset.index\n      if (sString === undefined || eString === undefined) return\n\n      const s = parseInt(sString, 10) + sel.anchorOffset\n      const e = parseInt(eString, 10) + sel.focusOffset\n\n      // check if selection does not cross two formulas (before / after)\n      const part1 = (sel.focusNode.parentNode as HTMLElement).dataset.part\n      const part2 = (sel.focusNode.parentNode as HTMLElement).dataset.part\n\n      if (!part1 || !part2) return\n      if (part1 !== part2) return\n\n      const part = part1\n      if (part !== 'start' && part !== 'end') {\n        return\n      }\n\n      const start = Math.min(s, e)\n      const end = Math.max(s, e)\n      if (start === end) {\n        return\n      }\n      const newAnimation = {\n        ...animation,\n        [part + 'Groups']: mergeSelections([\n          ...animation[(part + 'Groups') as 'endGroups' | 'startGroups'],\n          [colorIndex, start, end]\n        ])\n      }\n\n      setAnimation(newAnimation)\n    } catch (e) {\n      // Happend when you select non-formula stuff\n      // do nothing\n    } finally {\n      sel?.removeAllRanges()\n    }\n  }, [animation, colorIndex])\n\n  const handleClick = useCallback(\n    (ev, part: Part) => {\n      // remove\n      if (ev.button === 2) {\n        const index = ev.target.dataset.index\n        const groups = (part + 'Groups') as 'endGroups' | 'startGroups'\n        const selections = determineSelections(\n          animation[part],\n          animation[groups]\n        )\n        const activeSelection = selections[index]\n\n        if (!activeSelection) {\n          return\n        }\n\n        setAnimation({\n          ...animation,\n          [groups]: animation[groups].filter(\n            (s: Selection) => s !== activeSelection\n          )\n        })\n\n        return\n      }\n\n      // pick color\n      if (ev.button === 1) {\n        ev.preventDefault()\n        const group = ev.target.dataset.group\n        setColorIndex(+group)\n        return\n      }\n    },\n    [setAnimation, animation, setColorIndex, colorIndex]\n  )\n\n  // return <pre>{JSON.stringify(animation)}</pre>;\n\n  const splitChars = (part: Part) => {\n    const groups = (part + 'Groups') as 'endGroups' | 'startGroups'\n    const selections = determineSelections(animation[part], animation[groups])\n    return (\n      <div key={part}>\n        <span\n          className='formula'\n          style={{ fontFamily: 'Iosevka Term, monospace' }}\n          onMouseUp={(e) => handleClick(e, part)}\n          onContextMenu={(e) => e.preventDefault()}\n        >\n          {animation[part].split('').map((c: string, j: number) => {\n            const sel = selections[j]\n            const color = sel === null ? '' : allColors[sel[0]]\n            const group = sel === null ? -1 : sel[0]\n            return (\n              <span\n                key={j}\n                data-part={part}\n                data-index={j}\n                data-group={group}\n                style={{ background: color }}\n              >\n                {c}\n              </span>\n            )\n          })}\n        </span>\n      </div>\n    )\n  }\n\n  return (\n    <div className='animation' onMouseUp={() => handleSelection()}>\n      {(['start', 'end'] as Part[]).map(splitChars)}\n      <div className='preview'>\n        <AutoMorph\n          steps={[\n            convertToTeX(animation.start, animation.startGroups),\n            convertToTeX(animation.end, animation.endGroups)\n          ]}\n        />\n      </div>\n      {/* }<button className='remove' onClick={removeAnimation}>⨯</button> */}\n    </div>\n  )\n}\n\nfunction AutoMorph({ steps }: { steps: [string, string] }) {\n  const [step, setStep] = useState<0 | 1>(0)\n  const onClick = () => setStep((step) => ((step + 1) % 2) as 0 | 1)\n\n  return (\n    <div className='automorph' onClick={onClick}>\n      <Morph TIMING={1.0} display useAnimationDatabase={false}>\n        {steps[step]}\n      </Morph>\n    </div>\n  )\n}\n\nfunction determineSelections(\n  tex: string,\n  selections: Selection[]\n): (Selection | null)[] {\n  const colors: (Selection | null)[] = []\n  let levels: Selection[] = []\n  tex.split('').forEach((_c, i) => {\n    const ending = selections.filter(([_c, _s, e]) => e === i)\n\n    const starting = selections\n      .filter(([_c, s, _e]) => s === i)\n      .sort((a, b) => b[2] - a[2]) // descending on `end`\n\n    levels = levels.slice(0, levels.length - ending.length)\n    levels = [...levels, ...starting]\n\n    const currentActive = levels[levels.length - 1]\n    if (!currentActive) {\n      colors.push(null)\n    } else {\n      colors.push(currentActive)\n    }\n  })\n\n  return colors\n}\n\n// TODO: unit test this\nfunction mergeSelections(selections: Selection[]): Selection[] {\n  const result: Selection[] = []\n  selections.forEach(([color, start, end]) => {\n    const prev = result.find(([c, _s, e]) => e === start && c === color)\n    if (prev) {\n      prev[2] = end\n      return\n    }\n    const surrounding = result.find(\n      ([c, s, e]) => c === color && s <= start && e >= end\n    )\n\n    if (surrounding) {\n      // Don't include this selection, it is surrounded by a bigger selection of the same color\n      return\n    }\n\n    result.push([color, start, end])\n  })\n  return result\n}\n","import React, {\n  Fragment,\n  useEffect,\n  useState,\n  useRef,\n  useCallback,\n  useLayoutEffect\n} from 'react'\n\nimport { animate, SVGData } from './lib/morph.js'\nimport { lookupAnimationGroups } from './AnimationEditor'\n\nimport { usePrevious } from './utils.js'\n\nexport const wrapMathBasedOnProps = (\n  props: { display?: boolean; inline?: boolean },\n  s: string\n): string => {\n  if (props.display) {\n    return '$\\\\displaystyle ' + s + '$'\n  } else if (props.inline) {\n    return '$' + s + '$'\n  }\n  return s\n}\n\ntype MorphProps = {\n  children: string\n  display?: boolean\n  inline?: boolean\n  debug?: boolean\n  useAnimationDatabase?: boolean\n  replace?: boolean\n  TIMING?: number\n  style?: React.CSSProperties\n  className?: string\n}\n\n// TODO: maybe use useLayout effect for some things?\nfunction Morph({\n  children,\n  display,\n  inline,\n  debug,\n  useAnimationDatabase = true,\n  replace,\n  TIMING = 0.6,\n  style = {},\n  className = ''\n}: MorphProps): React.ReactElement {\n  const svgEl = useRef<SVGSVGElement | null>(null)\n  const [\n    {\n      viewBox: [vx, vy, vw, vh],\n      width,\n      height\n    },\n    setSvgData\n  ] = useState<SVGData>({\n    viewBox: [0, 0, 0, 0],\n    width: 0,\n    height: 0\n  })\n\n  const [transition, setTransition] = useState(false)\n\n  const FONT_SCALING_FACTOR = 2\n\n  const updateSvgData = ({ viewBox, width, height }: SVGData) => {\n    setSvgData({\n      viewBox,\n      width: FONT_SCALING_FACTOR * width,\n      height: FONT_SCALING_FACTOR * height\n    })\n  }\n\n  const wrapMath = useCallback(\n    (tex) => wrapMathBasedOnProps({ display, inline }, tex),\n    [display, inline]\n  )\n\n  const previousChildren = usePrevious(children)\n\n  // This eliminates \"fly in\" effect.\n  useLayoutEffect(() => {\n    if (!previousChildren) {\n      setTransition(false)\n    } else {\n      setTransition(true)\n    }\n  }, [children])\n\n  const promise = useRef(Promise.resolve())\n  const update = async (children: string) => {\n    const svg = svgEl.current\n    const anim = (text: string, replaceImediately: boolean) => {\n      if (!svg) return\n      return animate(svg, text, replaceImediately, TIMING, updateSvgData)\n    }\n\n    if (!children) {\n      await anim('', false)\n      return\n    }\n\n    if (typeof children !== 'string') {\n      console.error(\"Trying to compile something that is'nt text:\", children)\n      return\n    }\n\n    if (!previousChildren) {\n      await anim(wrapMath(children), false)\n      return\n    }\n\n    if (replace) {\n      await anim(wrapMath(children), true)\n      return\n    }\n\n    if (useAnimationDatabase) {\n      const [before, after] = lookupAnimationGroups(\n        previousChildren || '',\n        children\n      )\n\n      await anim(wrapMath(before), true)\n      await anim(wrapMath(after), false)\n    } else {\n      await anim(wrapMath(children), false)\n    }\n  }\n\n  useEffect(() => {\n    // This plays the animation after all the others have played.\n    // Makes sure two animations aren't playing at the same time\n\n    promise.current = promise.current\n      .then(() => update(children))\n      .catch(() => {\n        console.log('Failed to update Morph children')\n      })\n  }, [children])\n\n  const inner = (\n    <div\n      style={{\n        ...(display\n          ? {\n              left: '50%',\n              transform: `translate(${-width / 2}pt, 0)`\n            }\n          : {}),\n        width: 0,\n        height: 0,\n        marginTop: `${-vy * FONT_SCALING_FACTOR}pt`,\n        marginRight: `${width}pt`,\n        verticalAlign: 'baseline',\n        position: 'relative',\n        display: 'inline-block',\n        ...(transition\n          ? {\n              transition: `${TIMING}s margin-right, ${TIMING}s margin-top, ${TIMING}s transform`\n            }\n          : {\n              transition: ` ${TIMING}s margin-top`\n            }),\n        ...(debug ? { outline: '1px solid lightblue' } : {})\n      }}\n      className={className}\n    >\n      <svg\n        width={width + 'pt'}\n        height={height + 'pt'}\n        viewBox={[vx, vy, vw, vh].join(' ')}\n        style={{\n          display: 'inline-block',\n          position: 'absolute',\n          top: `${FONT_SCALING_FACTOR * vy}pt`,\n          verticalAlign: 'baseline',\n          ...(debug ? { outline: '1px solid yellow' } : {}),\n          ...style\n        }}\n        ref={svgEl}\n      />\n    </div>\n  )\n\n  if (display) {\n    return (\n      <div\n        style={{\n          display: 'flex',\n          flexGrow: 1,\n          height: height + 'pt',\n          margin: '0.5em 0',\n          transition: `${TIMING}s height`,\n          ...(debug ? { outline: '1px solid red' } : {})\n        }}\n      >\n        {inner}\n      </div>\n    )\n  } else {\n    return (\n      <Fragment>\n        {/* strut */}\n        <div\n          style={{\n            display: 'inline-block',\n            width: 0,\n            verticalAlign: 'text-top',\n            marginTop: '0.9em',\n            height: height + vy + 'pt',\n            ...(transition\n              ? { transition: `${TIMING}s height, ${TIMING}s margin-bottom` }\n              : {}),\n            ...(debug ? { width: '2px', background: 'limegreen' } : {})\n          }}\n        />\n        {inner}\n      </Fragment>\n    )\n  }\n}\n\nexport default Morph\n","import React from 'react'\nimport { PresentationContext, RenderSlide } from './Presentation'\nimport { CitationContext, RenderCite, CitationMap } from './Citations'\nimport Notes from './PresenterNotes'\n\nimport flattenDeep from 'lodash/flattenDeep'\nimport Morph, { wrapMathBasedOnProps } from './Morph'\nimport { lookupAnimationGroups } from './AnimationEditor'\n\n// TODO: does this also work for figures?\n\ntype FakeContextes = [React.Context<any>, any][]\nconst withFakeDispatcher = <T>(ctx: FakeContextes, cb: () => T): T => {\n  // I'll guess I'll be fired then ;)\n  const {\n    ReactCurrentDispatcher\n  } = (React as any).__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED\n  const original = ReactCurrentDispatcher.current\n\n  ReactCurrentDispatcher.current = {\n    useContext: (context: React.Context<any>): any => {\n      const result = ctx.find(([c, _]) => c === context)\n      if (result) {\n        return result[1]\n      }\n      return {}\n    },\n    readContext: () => null,\n    useCallback: (x: any) => x,\n    useEffect: () => null,\n    useImperativeHandle: () => null,\n    useLayoutEffect: () => null,\n    useMemo: (x: any) => x,\n    useReducer: (_: any, initialState: any) => initialState,\n    useRef: (initial: any) => {\n      const ref = { current: initial }\n      return ref\n    },\n    useState: (initial: any) => [initial, (x: any): any => x],\n    useDebugValue: () => null,\n    useResponder: () => null,\n    useDeferredValue: () => null,\n    useTransition: () => null\n  }\n\n  let result: T\n  try {\n    result = cb()\n  } finally {\n    ReactCurrentDispatcher.current = original\n  }\n  return result\n}\n\nconst isComponent = (\n  node: any\n): node is { type: (arg: any) => React.ReactElement } =>\n  node.type && typeof node.type === 'function'\n\nconst ignore: React.JSXElementConstructor<any>[] = [Morph, RenderCite]\nconst findElementsInTree = (\n  node: React.ReactElement,\n  predicate: (arg: any) => boolean\n): React.ReactElement[] => {\n  const found: React.ReactElement[] = []\n\n  const handleTree = (node: React.ReactElement): void => {\n    if (predicate(node)) {\n      found.push(node)\n      return\n    }\n\n    if (isComponent(node)) {\n      // Do not go deeper into Morphs, ...\n      if (ignore.includes(node.type)) {\n        return\n      }\n\n      const resolved = node.type(node.props)\n      // TODO: Maybe we should check if resolved is a ReactElement? Could maybe be string / ...?\n      return handleTree(resolved as React.ReactElement)\n    }\n\n    if (node.props && node.props.children) {\n      const childs = flattenDeep(\n        Array.isArray(node.props.children)\n          ? node.props.children\n          : [node.props.children]\n      )\n      childs.forEach((child) => {\n        if (child) {\n          handleTree(child as React.ReactElement)\n        }\n      })\n    }\n  }\n\n  handleTree(node)\n  return found\n}\n\ntype SlideAndProps = {\n  slide: React.ReactElement\n  props: { [key: string]: any }\n}\n\n// Does as it says. e.g.\n// <ProofSlide color='false'>\n//   resolves to -> <Slide header='test' />\n//\n//   the resulting props are {color: false, header: test, slide: the <Slide> component}\nconst getPropsRecursiveUntilSlideComponentIsEncountered = (\n  node: React.ReactElement\n): SlideAndProps => {\n  const props = node.props\n  const type = node.type as (arg: any) => React.ReactElement\n\n  if (type === RenderSlide) {\n    return { ...props, slide: node }\n  }\n\n  const resolved = type({ ...props })\n  const rest = getPropsRecursiveUntilSlideComponentIsEncountered(resolved)\n  return {\n    ...props,\n    ...rest\n  }\n}\n\nexport type SlideInfo = {\n  slide: React.ReactChild\n  info: { [key: string]: any }\n  steps: any[]\n  animations: { start: string; end: string }[]\n  allLaTeX: string[]\n  presenterNotes: React.ReactNode\n}\nexport type SlidesInfo = SlideInfo[]\nexport type SlidesInfoAndCitationMap = {\n  slidesInfo: SlidesInfo\n  citationMap: CitationMap\n}\n\nexport function getSlidesInfo(\n  slides: React.ReactElement[]\n): SlidesInfoAndCitationMap {\n  // TODO should probably make this a ES6 Map\n  const mockContextes: [any, any][] = [\n    [\n      PresentationContext,\n      {\n        i: 0,\n        slideIndex: 0,\n        slidesInfo: slides.map(() => ({ info: {} }))\n      }\n    ],\n    [\n      CitationContext,\n      {\n        bibliography: [],\n        citationMap: {}\n      }\n    ]\n  ]\n\n  // note that the steps prop is not yet okay: because the table of contents doesn't know yet how many sections there are, it cannot determine the number of steps ...\n  let slideWithProps: SlideAndProps[] = withFakeDispatcher(\n    mockContextes,\n    () => {\n      return slides.map(getPropsRecursiveUntilSlideComponentIsEncountered)\n    }\n  )\n\n  // this adds the current section to each of the slides\n  //\n  // slide:   1234567\n  // section: A   B\n  //\n  // gets transformed to\n  //\n  // slide:        1234567\n  // section:      AAAABBB\n  // sectionSlide: tffftff\n\n  type Info = {\n    section: string\n    hideNavigation: boolean\n    sectionSlide: boolean\n    header: string | null\n  }\n\n  const infos: Info[] = []\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  for (const { slide, ...props } of slideWithProps as {\n    slide: React.ReactElement\n    section?: string\n    hideNavigation?: boolean\n    header?: string\n    [key: string]: any\n  }[]) {\n    const accumulatedInfo = infos[infos.length - 1]\n    const newInfo = {\n      ...accumulatedInfo\n    }\n\n    newInfo.sectionSlide = !!props.section\n    newInfo.hideNavigation = !!props.hideNavigation\n\n    if (props.section) {\n      newInfo.section = props.section\n    }\n\n    if (props.header) {\n      newInfo.header = props.header\n    } else {\n      newInfo.header = null\n    }\n\n    infos.push(newInfo)\n  }\n\n  // Now we add this info to the presentation context\n  // Now the <TableOfContentsSlide /> knows how many sections there are, so it can calculate how many steps the slide is based on this.\n\n  const citationMap = withFakeDispatcher(mockContextes, () => {\n    return getCitations(slideWithProps.map((x) => x.slide))\n  })\n\n  mockContextes.find(\n    (x) => x[0] === PresentationContext\n  )![1].slidesInfo = infos.map((info) => ({ info }))\n\n  mockContextes.find(\n    (x) => x[0] === CitationContext\n  )![1].citationMap = citationMap\n\n  return withFakeDispatcher(mockContextes, () => {\n    slideWithProps = slides.map(\n      getPropsRecursiveUntilSlideComponentIsEncountered\n    )\n    const slidesInfo: SlideInfo[] = slideWithProps.map(\n      ({ slide, ...props }: SlideAndProps, index: number): SlideInfo => ({\n        slide,\n        info: infos[index],\n        steps: (props as { steps?: any[] }).steps || [null],\n        ...animations(slide),\n        presenterNotes: presenterNotes(slide)\n      })\n    )\n\n    console.log(slidesInfo, citationMap)\n    // GOAL: (be able to) pre fetch all the latex of all slides.\n    // Problem: animate from lib/morph does some replaces on these strings that we should do as well before trying to compile this.\n    // OR: move these replacements elsewhere\n    return { slidesInfo, citationMap }\n  })\n}\n\nconst presenterNotes = (slide: React.ReactElement): React.ReactNode => {\n  let tree: React.ReactElement\n  if (!slide.props.steps || typeof slide.props.children !== 'function') {\n    tree = slide\n  } else {\n    tree = slide.props.children(slide.props.steps[0])\n  }\n\n  const notes = findElementsInTree(\n    tree,\n    (node) => typeof node.type === 'function' && node.type === Notes\n  )\n  if (notes.length > 1) {\n    console.error('On slide ', slide, 'you have more than one <Notes>!')\n  }\n  const note = notes[0]\n  if (!note) return null\n  return note.props.children\n}\n\nconst animations = (slide: React.ReactElement) => {\n  class MorphArray extends Array<string> {\n    props?: { [key: string]: any }\n  }\n\n  const allLaTeX: string[] = []\n  const morphs: { [key: string]: MorphArray } = {}\n\n  const defaultResult = {\n    animations: [],\n    allLaTeX: []\n  }\n  if (!slide.props.steps) return defaultResult\n\n  if (typeof slide.props.children !== 'function') {\n    // If type is not a function, we have no animations.\n    return defaultResult\n  }\n\n  slide.props.steps.forEach((step: any) => {\n    const tree = slide.props.children(step)\n\n    findElementsInTree(\n      tree,\n      (node) => typeof node.type === 'function' && node.type === Morph\n    ).forEach((node) => {\n      // should also apply groups ...\n\n      if (node.props.replace) {\n        // No animations to consider, is replaced immediately\n        // Is used for plain LaTeX (<Morph replace />)\n\n        if (node.props.children) {\n          allLaTeX.push(wrapMathBasedOnProps(node.props, node.props.children))\n        }\n        return\n      }\n      const id = JSON.stringify(((node as any) as { _source: any })._source)\n      const contents = node.props.children\n      morphs[id] = morphs[id] ? [...morphs[id], contents] : [contents]\n      morphs[id].props = node.props\n\n      // this is a bit fishy, setting a property of an array. Need it later to wrap the math correctly.\n    })\n  })\n\n  const anim: { start: string; end: string }[] = []\n  for (const key in morphs) {\n    const formulas = morphs[key]\n    formulas.forEach((formula: string, i: number) => {\n      const start = formula\n      const end = formulas[i + 1]\n      if (i < formulas.length - 1 && start !== end) {\n        anim.push({ start, end })\n\n        if (start && end) {\n          if (!formulas.props) {\n            // This shouldn't happen\n            return\n          }\n          // start and end not undefined\n          const [startGrouped, endGrouped] = lookupAnimationGroups(start, end)\n          allLaTeX.push(wrapMathBasedOnProps(formulas.props, startGrouped))\n          allLaTeX.push(wrapMathBasedOnProps(formulas.props, endGrouped))\n        }\n      }\n    })\n  }\n\n  return {\n    animations: anim,\n    allLaTeX: allLaTeX\n  }\n}\n\nfunction getCitations(slides: React.ReactElement[]): CitationMap {\n  const citationMap: CitationMap = {}\n\n  slides.forEach((slide) => {\n    let trees = [slide]\n    if (typeof slide.props.children === 'function' && !!slide.props.steps) {\n      trees = slide.props.steps.map((step: any) => slide.props.children(step))\n    }\n\n    trees.forEach((tree) => {\n      findElementsInTree(\n        tree,\n        (node) => typeof node.type === 'function' && node.type === RenderCite\n      ).forEach((cite) => {\n        const id = cite.props.id\n        if (!citationMap[id]) {\n          const number = Math.max(0, ...Object.values(citationMap)) + 1\n          citationMap[id] = number\n        }\n      })\n    })\n  })\n  return citationMap\n}\n","import React, {\n  useEffect,\n  useState,\n  useContext,\n  useCallback,\n  useMemo,\n  useLayoutEffect\n} from 'react'\n\nimport { getSlidesInfo, SlidesInfo } from './staticAnalysis'\n\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Redirect,\n  useParams,\n  generatePath,\n  useRouteMatch,\n  useHistory\n} from 'react-router-dom'\n\nimport { CitationProvider } from './Citations'\nimport AnimationEditor from './AnimationEditor'\nimport { LaTeX, fetchLaTeXSvg } from './utils'\n\ntype PresentationRenderFunction = (arg: {\n  slideIndex: number\n  stepIndex: number\n  slidesInfo: SlidesInfo\n  slides: React.ReactChild[]\n}) => React.ReactNode\n\nexport interface PresentationProps {\n  children: React.ReactNode\n  bibUrl?: string\n  compileHost?: string\n  preamble?: string\n}\n\ninterface InternalPresentationProps extends PresentationProps {\n  render: PresentationRenderFunction\n  presenter?: boolean\n  fullscreen?: boolean\n}\n\n/* global localStorage */\nexport function RenderPresentation({\n  children,\n  ...props\n}: InternalPresentationProps): React.ReactElement {\n  return (\n    <Router>\n      <Switch>\n        <Route exact path='/storage'>\n          <Storage />\n        </Route>\n\n        <Route path='/presenter/:slideIndex?/:stepIndex?'>\n          <PresentationUI presenter {...props}>\n            {children}\n          </PresentationUI>\n        </Route>\n        <Route path='/fullscreen/:slideIndex?/:stepIndex?'>\n          <PresentationUI fullscreen {...props}>\n            {children}\n          </PresentationUI>\n        </Route>\n        <Route path='/overview'>\n          <PresentationOverview {...props}>{children}</PresentationOverview>\n        </Route>\n        <Route path='/:slideIndex?/:stepIndex?' exact={false}>\n          <PresentationUI {...props}>{children}</PresentationUI>\n        </Route>\n      </Switch>\n    </Router>\n  )\n}\n\nexport const PresentationContext = React.createContext<PresentationContextInterface | null>(\n  null\n)\n\nexport interface PresentationContextInterface {\n  slideIndex: number\n  stepIndex: number\n  i: number\n  slidesInfo: SlidesInfo\n  setTransitions: (arg: any) => void\n  transition: Transition\n}\n\ntype RouteParams = { slideIndex: string; stepIndex: string }\n\ntype Transition = {\n  before?: React.CSSProperties\n  after?: React.CSSProperties\n}\n\nexport type Transitions = {\n  [key: number]: Transition\n}\n\nfunction PresentationUI({\n  children,\n  render,\n  bibUrl,\n  preamble = '',\n  compileHost = '',\n  presenter,\n  fullscreen\n}: InternalPresentationProps) {\n  const reactSlides = React.Children.toArray(children) as React.ReactElement[]\n  const { slidesInfo, citationMap } = useMemo(\n    () => getSlidesInfo(reactSlides),\n    [children]\n  )\n\n  // TODO: this is used multiple times.\n  // Extract this.\n  useLayoutEffect(() => {\n    LaTeX.setPreamble(preamble)\n    if (compileHost) {\n      console.log('setting host to', compileHost)\n      LaTeX.setHost(compileHost)\n    }\n\n    // TODO: only in non-dev mode\n    /* console.log('COMPILING ALL TEX')\n    const latex = Array.from(\n      new Set(slidesInfo.flatMap((slide) => slide.allLaTeX))\n    )\n    const allStart = Date.now()\n    Promise.all(\n      latex.map(async (tex, i) => {\n        const start = Date.now()\n        await fetchLaTeXSvg(tex)\n        const end = Date.now()\n        const seconds = (end - start) / 1000\n        console.log(`[${i + 1}/${latex.length}] compiled ${tex} (${seconds})`)\n        return seconds\n      })\n    ).then((seconds) => {\n      const allEnd = Date.now()\n      const mean = seconds.reduce((a, b) => a + b, 0) / seconds.length\n      console.log(\n        'Done with compilation. Mean time:',\n        mean,\n        'Total time: ',\n        (allEnd - allStart) / 1000\n      )\n      }) */\n  }, [preamble, compileHost])\n\n  const match = useRouteMatch()\n  const history = useHistory()\n\n  const {\n    slideIndex: slideIndexString = '0',\n    stepIndex: stepIndexString = '0'\n  } = useParams<RouteParams>()\n  const slideIndex = parseInt(slideIndexString)\n  const stepIndex = parseInt(stepIndexString)\n\n  const [transitions, setTransitions] = useState<Transitions>({})\n\n  const bc = useMemo(() => new BroadcastChannel('presentation'), [])\n  bc.onmessage = useCallback((event) => {\n    setSlideAndStep(event.data.slideIndex, event.data.stepIndex, false)\n  }, [])\n\n  const setSlideAndStep = (\n    slideIndex: number,\n    stepIndex: number,\n    notify = true\n  ) => {\n    history.push(generatePath(match.path, { slideIndex, stepIndex }))\n    if (notify) {\n      bc.postMessage({ slideIndex, stepIndex })\n    }\n  }\n\n  const getNext = (slideIndex: number, stepIndex: number): [number, number] => {\n    if (stepIndex < slidesInfo[slideIndex].steps.length - 1) {\n      return [slideIndex, stepIndex + 1]\n    }\n    if (slideIndex < slidesInfo.length - 1) {\n      return [slideIndex + 1, 0]\n    }\n    return [slideIndex, stepIndex]\n  }\n\n  const getPrev = (slideIndex: number, stepIndex: number): [number, number] => {\n    if (stepIndex > 0) {\n      return [slideIndex, stepIndex - 1]\n    }\n    if (slideIndex > 0) {\n      return [slideIndex - 1, slidesInfo[slideIndex - 1].steps.length - 1]\n    }\n    return [slideIndex, stepIndex]\n  }\n\n  const prev = useCallback(\n    (dontStepButGoToPrevSlide) => {\n      if (dontStepButGoToPrevSlide) {\n        if (slideIndex > 0) {\n          setSlideAndStep(slideIndex - 1, 0)\n        }\n        return\n      }\n      setSlideAndStep(...getPrev(slideIndex, stepIndex))\n    },\n    [slideIndex, stepIndex, setSlideAndStep]\n  )\n\n  const next = useCallback(\n    (dontStepButGoToNextSlide) => {\n      if (dontStepButGoToNextSlide) {\n        if (slideIndex < slidesInfo.length - 1) {\n          setSlideAndStep(slideIndex + 1, 0)\n        }\n      } else {\n        setSlideAndStep(...getNext(slideIndex, stepIndex))\n      }\n    },\n    [slideIndex, stepIndex, setSlideAndStep]\n  )\n\n  const handleKey = useCallback(\n    (e) => {\n      if (e.key === 'ArrowDown') {\n        next(true)\n      }\n      if (e.key === 'ArrowUp') {\n        prev(true)\n      }\n\n      if (e.key === 'PageDown' || e.key === 'ArrowRight') {\n        e.preventDefault()\n        next(false)\n      } else if (e.key === 'PageUp' || e.key === 'ArrowLeft') {\n        e.preventDefault()\n        prev(false)\n      }\n    },\n    [next, prev, stepIndex, slideIndex]\n  )\n\n  useEffect(() => {\n    window.addEventListener('keydown', handleKey)\n    return () => {\n      window.removeEventListener('keydown', handleKey)\n    }\n  }, [handleKey])\n\n  if (slideIndex > slidesInfo.length) {\n    return <div>Too high slide number!</div>\n  }\n\n  if (presenter) {\n    const slides = [\n      [slideIndex, stepIndex],\n      getNext(slideIndex, stepIndex)\n    ].map(([slideIndex, stepIndex], index) =>\n      render({\n        slideIndex,\n        stepIndex,\n        slidesInfo,\n        slides: [\n          <PresentationContext.Provider\n            key={index}\n            value={{\n              i: slideIndex,\n              slideIndex,\n              slidesInfo,\n              stepIndex,\n              setTransitions: () => undefined,\n              transition: {\n                after: { transform: '' },\n                before: { transform: '' }\n              }\n            }}\n          >\n            {reactSlides[slideIndex]}\n          </PresentationContext.Provider>\n        ]\n      })\n    )\n\n    return (\n      <div className='flex'>\n        <CitationProvider citationMap={citationMap} bibUrl={bibUrl}>\n          <div className='flex justify-around'>\n            <div className='flex flex-col'>\n              <div>{slides[0]}</div>\n              <div className='text-lg'>\n                <Clock />\n              </div>\n            </div>\n            <div className='flex flex-col'>\n              <div\n                style={{\n                  transform: 'scale(0.5)',\n                  transformOrigin: 'top left',\n                  marginBottom: -450\n                }}\n              >\n                {slides[1]}\n              </div>\n              <div>{slidesInfo[slideIndex].presenterNotes}</div>\n            </div>\n          </div>\n        </CitationProvider>\n      </div>\n    )\n  }\n\n  const wrappedSlides = reactSlides.map((slide, i) => {\n    return (\n      <PresentationContext.Provider\n        key={i}\n        value={{\n          i,\n          slideIndex,\n          slidesInfo: slidesInfo,\n          stepIndex:\n            i === slideIndex\n              ? stepIndex\n              : i < slideIndex && slidesInfo[i].steps.length\n              ? slidesInfo[i].steps.length - 1\n              : 0,\n          setTransitions,\n          transition: transitions[i]\n        }}\n      >\n        {slide}\n      </PresentationContext.Provider>\n    )\n  })\n\n  const threeSlides = wrappedSlides.slice(\n    Math.max(0, slideIndex - 1),\n    Math.min(wrappedSlides.length, slideIndex + 2)\n  )\n\n  if (fullscreen) {\n    return (\n      <div className='flex justify-center items-center bg-blue h-screen'>\n        <CitationProvider citationMap={citationMap} bibUrl={bibUrl}>\n          {render({\n            slideIndex,\n            stepIndex,\n            slidesInfo,\n            slides: threeSlides\n          })}\n        </CitationProvider>\n      </div>\n    )\n  }\n\n  return (\n    <CitationProvider citationMap={citationMap} bibUrl={bibUrl}>\n      <div className='flex h-screen bg-blue'>\n        {render({\n          slideIndex,\n          stepIndex,\n          slidesInfo,\n          slides: threeSlides\n        })}\n        <Tabs>\n          <Tab label='Presenter notes'>\n            {slidesInfo[slideIndex].presenterNotes ? (\n              <div className='text-sm p-2'>\n                {slidesInfo[slideIndex].presenterNotes}\n              </div>\n            ) : null}\n          </Tab>\n          <Tab label='Animation editor'>\n            {slidesInfo[slideIndex].animations.length ? (\n              <AnimationEditor animations={slidesInfo[slideIndex].animations} />\n            ) : null}\n          </Tab>\n        </Tabs>\n      </div>\n    </CitationProvider>\n  )\n}\n\nfunction Tabs({ children }: { children: React.ReactNode }) {\n  return (\n    <div className='bg-gray-900 w-full h-screen overflow-y-scroll'>\n      {children}\n    </div>\n  )\n}\n\nfunction Tab({\n  label,\n  children\n}: {\n  label: string\n  children: React.ReactNode\n}) {\n  const [show, setShow] = useState(true)\n  if (!children) return null\n  return (\n    <div className='w-full'>\n      <div\n        className='p-1 px-2 text-xs uppercase cursor-pointer sticky top-0 z-50 bg-gray-700'\n        onClick={() => setShow((s) => !s)}\n      >\n        {label}\n      </div>\n      {show && <div>{children}</div>}\n    </div>\n  )\n}\n\nfunction Clock(): React.ReactElement {\n  return <div className='flex justify-center items-center'>20:00</div>\n}\n\nfunction PresentationOverview({\n  children,\n  render,\n  bibUrl,\n  preamble = '',\n  compileHost\n}: InternalPresentationProps): React.ReactElement {\n  useLayoutEffect(() => {\n    LaTeX.setPreamble(preamble)\n    if (compileHost) {\n      LaTeX.setHost(compileHost)\n    }\n  }, [preamble])\n\n  const reactSlides = React.Children.toArray(children) as React.ReactElement[]\n\n  const { slidesInfo, citationMap } = useMemo(\n    () => getSlidesInfo(reactSlides),\n    [children]\n  )\n\n  return (\n    <div>\n      <CitationProvider citationMap={citationMap} bibUrl={bibUrl}>\n        {slidesInfo.flatMap((info, slideIndex) => {\n          return info.steps.map((_step: any, stepIndex) => {\n            return (\n              <div key={`${slideIndex}-${stepIndex}`}>\n                {render({\n                  slidesInfo,\n                  slideIndex,\n                  stepIndex,\n                  slides: [\n                    <PresentationContext.Provider\n                      key={slideIndex}\n                      value={{\n                        slidesInfo,\n                        stepIndex,\n                        slideIndex,\n                        i: slideIndex,\n                        setTransitions: () => null,\n                        transition: {\n                          before: {},\n                          after: {}\n                        }\n                      }}\n                    >\n                      {reactSlides[slideIndex]}\n                    </PresentationContext.Provider>\n                  ]\n                })}\n              </div>\n            )\n          })\n        })}\n      </CitationProvider>\n    </div>\n  )\n}\n\ntype SlideProps = {\n  render: SlideRenderFunction\n  steps?: any[]\n  children: React.ReactNode\n}\n\ntype SlideRenderFunction = (arg: {\n  slidesInfo: SlidesInfo\n  children: React.ReactNode | ((step: any) => React.ReactNode)\n  slideIndex: number\n  i: number\n  style: React.CSSProperties\n}) => React.ReactElement\n\nconst hasSteps = (node: any): node is (step: any) => React.ReactNode =>\n  node.call\n\n// Add timeline ={{ ... }} shorthand\nexport function RenderSlide({\n  children,\n  steps = [],\n  render\n}: SlideProps): React.ReactElement {\n  const TIMING = 0.5\n  const { stepIndex = 0, i = 0, slideIndex = 0, transition, slidesInfo = [] } =\n    useContext(PresentationContext) || {}\n\n  const [style, setStyle] = useState<React.CSSProperties>({\n    transition: `${TIMING}s transform, ${TIMING}s opacity`,\n    transform: 'scale(1) translate3d(0px, 0px, 0px)',\n    opacity: 0\n  })\n\n  const updateStyle = (style: React.CSSProperties) =>\n    setStyle((s) => ({ ...s, ...style }))\n\n  // delay rendering\n  // const [shouldRender, setRender] = useState(false)\n  // useEffect(() => {\n  //   setTimeout(() => setRender(true), 500)\n  // }, [])\n\n  useEffect(() => {\n    const {\n      after = {\n        transform: `translate3d(-100%, 0px, 0px)`,\n        opacity: 0,\n        zIndex: 0\n      },\n      before = {\n        transform: `translate3d(100%, 0px, 0px)`,\n        opacity: 0,\n        zIndex: 0\n      }\n    } = transition || {}\n\n    if (i > slideIndex) {\n      updateStyle({ ...before })\n    }\n    if (i < slideIndex) {\n      updateStyle({ ...after })\n    }\n    if (i === slideIndex) {\n      updateStyle({\n        zIndex: 10,\n        opacity: 1,\n        transform: `scale(1) translate3d(0px,0px,0px)`\n      })\n    }\n  }, [slideIndex, i, transition])\n\n  // if (shouldRender) {\n  const content =\n    children && (hasSteps(children) ? children(steps[stepIndex]) : children)\n  return render({ slidesInfo, children: content, i, slideIndex, style })\n  // }\n  // return render({info, content: <div />, i, slideIndex, style});\n}\n\nfunction Storage(): React.ReactElement {\n  return (\n    <pre\n      style={{\n        whiteSpace: 'break-spaces'\n      }}\n    >\n      {localStorage.animationGroups}\n    </pre>\n  )\n}\n","import React from 'react'\n\ntype ShowProps = {\n  when: boolean\n  children: React.ReactNode\n  opacity?: number\n}\nexport default function Show({\n  when,\n  children,\n  opacity\n}: ShowProps): React.ReactElement {\n  const realStyle: React.CSSProperties = {\n    opacity: opacity !== undefined ? opacity : when ? 1 : 0,\n    transition: '0.5s opacity ease-in-out'\n  }\n\n  return (\n    // TODO: props don't get correctly cloned?\n    <React.Fragment>\n      {React.Children.map(children, (c: React.ReactNode) => {\n        if (React.isValidElement(c)) {\n          return React.cloneElement(c, {\n            ...(c.props || {}),\n            style: {\n              ...(c?.props?.style || {}),\n              ...realStyle\n            }\n          })\n        } else {\n          return <span style={realStyle}>{c}</span>\n        }\n      })}\n    </React.Fragment>\n  )\n}\n\n// TODO: Animate height of an element\n// export function Grow({when, children, opacity}) {\n","import React, { Fragment, useState, useEffect, useRef, useContext } from 'react'\n\nimport {\n  RenderSlide,\n  RenderPresentation,\n  PresentationContext,\n  PresentationProps\n} from '../../Presentation'\nimport { RenderCite, RenderBibliography } from '../../Citations'\n\nimport Show from '../../Show'\n\nimport { SlideInfo } from '../../staticAnalysis'\n\n// import sedes from './kuleuvensedes.svg'\n/* import pointer from './pointer.png' */\n//\nimport './styles.css'\n\nimport step from '../../step.macro.js'\nimport { range } from '../../utils.js'\n\nexport function Presentation(props: PresentationProps): React.ReactElement {\n  const h = 900\n  const w = 1200\n  return (\n    <RenderPresentation\n      {...props}\n      render={({ slides, slideIndex, slidesInfo }) => {\n        const info = slidesInfo[slideIndex].info\n        return (\n          <div\n            className='inline-block relative flex-shrink-0 flex flex-col text-white bg-blue'\n            style={{\n              overflow: 'hidden',\n              fontFamily: 'Computer Modern Sans',\n              width: w,\n              height: h\n              // border: '1px solid white'\n            }}\n          >\n            <div className='flex-grow relative'>{slides}</div>\n            <div\n              className='flex flex-col'\n              style={{\n                transition: '0.5s transform',\n                transform: `translate(0px, ${info.hideNavigation ? 100 : 0}%)`\n              }}\n            >\n              <div className='flex justify-between text-xs theme-font-open'>\n                <div className='px-2 py-1'>\n                  {info.sectionSlide ? '\\xa0' : info.section}\n                </div>\n                <div className='px-2 py-1'>{slideIndex + 1}</div>\n              </div>\n              <div className='w-full inline-block' style={{ height: 2 }}>\n                <div\n                  className='h-full bg-green'\n                  style={{\n                    width: `${(slideIndex / (slidesInfo.length - 1)) * 100}%`,\n                    transition: 'width 0.5s'\n                  }}\n                />\n              </div>\n            </div>\n          </div>\n        )\n      }}\n    />\n  )\n}\n\n/* export function MousePointer(): React.ReactElement { */\n/*   const [position, setPosition] = useState({ x: 0, y: 0 }) */\n/*   const [hidden, setHidden] = useState(true) */\n/*   const currentTimer = useRef(null) */\n/*   useEffect(() => { */\n/*     const setFromEvent = (e: MouseEvent) => { */\n/*       setHidden(false) */\n/*       clearTimeout(currentTimer.current) */\n/*       currentTimer.current = setTimeout(() => setHidden(true), 1000) */\n/*       setPosition({ x: e.clientX, y: e.clientY }) */\n/*     } */\n/*     window.addEventListener('mousemove', setFromEvent) */\n/*     return () => { */\n/*       window.removeEventListener('mousemove', setFromEvent) */\n/*     } */\n/*   }, []) */\n/*   const { x, y } = position */\n/*   const width = 8 */\n/*   const height = 8 */\n/*   return ( */\n/*     <img */\n/*       alt='' */\n/*       width={width} */\n/*       height={height} */\n/*       src={pointer} */\n/*       style={{ */\n/*         display: hidden ? 'none' : 'inline', */\n/*         position: 'fixed', */\n/*         left: 0, */\n/*         top: 0, */\n/*         zIndex: 10, */\n/*         pointerEvents: 'none', */\n/*         transform: `translate(${x - width / 2}px, ${y - height / 2}px)` */\n/*       }} */\n/*     /> */\n/*   ) */\n/* } */\n\nexport function Slide({\n  className,\n  children,\n  style: slideStyle,\n  ...props\n}: {\n  className?: string\n  children: React.ReactNode\n  style?: React.CSSProperties\n  [key: string]: any\n}): React.ReactElement {\n  return (\n    <RenderSlide\n      children={children}\n      {...props}\n      render={({ slidesInfo, children, i, style }) => {\n        const info = slidesInfo[i].info\n        return (\n          <div\n            className='slide'\n            style={{\n              position: 'absolute',\n              left: 0,\n              top: 0,\n              bottom: 0,\n              right: 0,\n              ...style\n            }}\n          >\n            <div className='absolute inset-0 flex flex-col'>\n              {info.header && (\n                <div className='ml-6 mt-6 text-white font-semibold text-lg flex items-center theme-font-open'>\n                  <span\n                    style={{\n                      height: '2em',\n                      width: '4px',\n                      marginRight: '1em',\n                      background: '#00D56F',\n                      borderRadius: '2px'\n                    }}\n                  />\n                  {info.header}\n                </div>\n              )}\n              <div className={`flex-grow p-6 ${className}`} style={slideStyle}>\n                {children}\n              </div>\n            </div>\n          </div>\n        )\n      }}\n    />\n  )\n}\n\nexport function SectionSlide({\n  section,\n  children\n}: {\n  section: string\n  children: React.ReactNode\n}): React.ReactElement {\n  const { i = 0, slidesInfo = [] } = useContext(PresentationContext) || {}\n  const numSlides = slidesInfo.length\n  return (\n    <Slide\n      className='flex justify-center items-center text-3xl theme-font-open'\n      hideNavigation\n    >\n      <div>\n        <div>{section}</div>\n        <div\n          className='mt-3'\n          style={{\n            background: 'rgba(255, 255, 255, 0.2)',\n            width: '16em',\n            height: '4px',\n            borderRadius: '2px'\n          }}\n        >\n          <div\n            className='h-full bg-green'\n            style={{\n              width: `${(i / (numSlides - 1)) * 100}%`,\n              borderRadius: '2px'\n            }}\n          />\n        </div>\n      </div>\n      {children}\n    </Slide>\n  )\n}\n\n// TOCO conclusion slide should clear section ...\nexport function ConclusionSlide({\n  section,\n  children\n}: {\n  section: string\n  children: React.ReactNode\n}): React.ReactElement {\n  return (\n    <Slide\n      hideNavigation\n      className='flex justify-center items-center text-3xl theme-font-open'\n    >\n      <div>\n        <div>{section}</div>\n        <div\n          className='bg-gray-300 mt-3'\n          style={{\n            width: '16em',\n            height: '4px'\n          }}\n        >\n          <div\n            className='h-full bg-green'\n            style={{\n              width: `100%`\n            }}\n          />\n        </div>\n      </div>\n      {children}\n    </Slide>\n  )\n}\n\nexport function TitleSlide({\n  title,\n  names,\n  names2,\n  date,\n  children\n}: {\n  title: React.ReactNode\n  subtitle: React.ReactNode\n  names: React.ReactNode\n  names2: React.ReactNode\n  date: React.ReactNode\n  children: React.ReactNode\n}): React.ReactElement {\n  return (\n    <Slide\n      className='flex flex-col items-stretch justify-between theme-font-open'\n      steps={[0, 1, 2]}\n      hideNavigation\n    >\n      {(step: number) => (\n        <Fragment>\n          <div className='flex-grow flex flex-col justify-center'>\n            <Show when={step > 0}>\n              <h1 className='text-4xl font-semibold text-green'>{title}</h1>\n            </Show>\n          </div>\n          <Show when={step > 1}>\n            <div className='text-sm flex items-end justify-between'>\n              <div>\n                <div>{names}</div>\n                <div>{names2}</div>\n              </div>\n              <div>{date}</div>\n            </div>\n          </Show>\n          {children}\n        </Fragment>\n      )}\n    </Slide>\n  )\n}\n\nexport function TableOfContentsSlide({\n  header,\n  children\n}: {\n  header: React.ReactNode\n  children: React.ReactNode\n}): React.ReactElement {\n  const { slidesInfo = [] } = useContext(PresentationContext) || {}\n\n  const sections: string[] = slidesInfo\n    .map((i) => i.info.section)\n    .filter(Boolean)\n    .filter((v, i, a) => a.indexOf(v) === i)\n\n  return (\n    <Slide\n      hideNavigation\n      header={header}\n      steps={sections.map((_, i) => i)}\n      className='flex items-start'\n    >\n      {(step: number) => (\n        <React.Fragment>\n          <ol>\n            {sections.map((section: string, i: number) => (\n              <Show key={section} when={step >= i}>\n                <li className='my-5'>{section}</li>\n              </Show>\n            ))}\n          </ol>\n          {children}\n        </React.Fragment>\n      )}\n    </Slide>\n  )\n}\n\nexport function QuestionSlide({\n  title = 'Questions?',\n  children\n}: {\n  title: React.ReactNode\n  children: React.ReactNode\n}): React.ReactElement {\n  return (\n    <Slide\n      className='bg-blue text-gray-100 text-3xl flex items-center justify-center p-0'\n      hideNavigation\n    >\n      {title}\n      {children}\n    </Slide>\n  )\n}\n\n// TODO: svg object fit?\nexport function Figure({\n  children,\n  caption\n}: {\n  children: React.ReactNode\n  caption: React.ReactNode\n}): React.ReactElement {\n  return (\n    <div className='flex flex-col'>\n      <div className='flex-grow'>{children}</div>\n      {caption && (\n        <div className='p-1'>\n          <b>Figure:</b> {caption}\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport function List({\n  children,\n  step,\n  ...props\n}: {\n  children: React.ReactNode\n  step: number\n  [key: string]: any\n}): React.ReactElement {\n  const childArray = React.Children.toArray(children)\n  return (\n    <ul {...props}>\n      {childArray.map((child, i) => (\n        <Show key={i} when={i < step || step === undefined}>\n          {child}\n        </Show>\n      ))}\n    </ul>\n  )\n}\n\nexport function Item({\n  children,\n  name,\n  ...props\n}: {\n  children: React.ReactNode\n  name?: React.ReactNode\n  style?: React.CSSProperties\n  [key: string]: any\n}): React.ReactElement {\n  if (name) {\n    return (\n      <li\n        {...props}\n        style={{\n          ...(props.style || {}),\n          listStyle: 'none'\n        }}\n      >\n        <b>{name + ' '}</b>\n        {children}\n      </li>\n    )\n  } else {\n    return <li {...props}>{children}</li>\n  }\n}\n\nexport function Cite({\n  id,\n  hidden\n}: {\n  id: string\n  hidden?: boolean\n}): React.ReactElement {\n  return (\n    <RenderCite\n      id={id}\n      render={({ text, number }) => {\n        if (hidden) return <span />\n        return <span title={text || 'Loading ...'}>[{number || '??'}]</span>\n      }}\n    />\n  )\n}\n\nexport function BibliographySlide(): React.ReactElement {\n  const stride = 4\n  return (\n    <RenderBibliography\n      render={(items) => {\n        return (\n          <Slide steps={range(Math.ceil(items.length / stride))}>\n            {(step: number) => {\n              if (!items) return <div>Loading</div>\n\n              const start = stride * step\n              const end = start + stride\n              return (\n                <ul className='list-none text-sm'>\n                  {items.slice(start, end).map(({ id, n, html }) => {\n                    return (\n                      <li className='flex my-2' key={id}>\n                        <span className='mr-2'>[{n}]</span>\n                        <div className='inline-block'>\n                          <span dangerouslySetInnerHTML={{ __html: html }} />\n                        </div>\n                      </li>\n                    )\n                  })}\n                </ul>\n              )\n            }}\n          </Slide>\n        )\n      }}\n    />\n  )\n}\n\ntype BoxProps = {\n  title?: string\n  children: React.ReactNode\n  className?: string\n  smallTitle?: boolean\n  style?: React.CSSProperties\n}\nexport function Box({\n  title,\n  children,\n  className,\n  smallTitle,\n  style\n}: BoxProps): React.ReactElement {\n  return (\n    <div\n      className={`theme-border theme-shadow ${className || ''}`}\n      style={style}\n    >\n      <div className='p-2'>\n        {title && (\n          <span\n            className={`pr-2 text-green font-semibold ${\n              smallTitle ? 'text-xs block' : ''\n            }`}\n          >\n            {title}.\n          </span>\n        )}\n        {children}\n      </div>\n    </div>\n  )\n}\n\nexport function Qed(\n  props: React.HTMLProps<HTMLDivElement>\n): React.ReactElement {\n  return (\n    <div className='flex justify-end' {...props}>\n      <div className='inline-block w-2 h-2 bg-white m-1' />\n    </div>\n  )\n}\n","import React, { useEffect, useRef } from 'react'\n\nimport memoize from 'memoizee'\n\nimport { animate } from './lib/morph'\n\nimport gsap from 'gsap'\nimport MorphSVGPlugin from 'gsap-bonus/MorphSVGPlugin'\nimport DrawSVGPlugin from 'gsap-bonus/DrawSVGPlugin'\n\ngsap.registerPlugin(MorphSVGPlugin, DrawSVGPlugin)\n\n/* global fetch */\n\nconst positionSvg = (textSvg: SVGElement): void => {\n  // This function posititions the generated svg of some LaTeX code correctly in the parent svg.\n\n  const [, vy, ,] = textSvg\n    .getAttribute('viewBox')!\n    .split(' ')\n    .map((s) => parseFloat(s))\n  const width = parseFloat(textSvg.getAttribute('width')!.replace('pt', ''))\n  const height = parseFloat(textSvg.getAttribute('height')!.replace('pt', ''))\n\n  const {\n    scale: scaleString,\n    textX: textXString,\n    textY: textYString\n  }: {\n    scale?: string\n    textX?: string\n    textY?: string\n  } = textSvg.dataset\n\n  const FONT_SCALING_FACTOR = 2\n  const scale = parseFloat(scaleString || '0')\n  const textX = parseFloat(textXString || '0')\n  const textY = parseFloat(textYString || '0')\n\n  // The (x, y) of the text refers to the text anchor.\n  // The (x, y) of the svg refers to the top left corner\n  // Therefore, as the base line of the svg generated by latex is (0, 0),\n  // we translate the svg by vy, keeping in mind the SCALE and the conversion between px and pt (*1.3)\n\n  textSvg.dataset.scale = String(scale)\n\n  textSvg.setAttribute('x', textX + 'px')\n  textSvg.setAttribute(\n    'y',\n    textY + FONT_SCALING_FACTOR * scale * vy * 1.3 + 'px'\n  )\n  textSvg.setAttribute('width', FONT_SCALING_FACTOR * scale * width + 'pt')\n  textSvg.setAttribute('height', FONT_SCALING_FACTOR * scale * height + 'pt')\n}\n\nconst replaceText = async (textEle: SVGGraphicsElement) => {\n  const text = textEle.textContent\n  if (!text) return\n\n  const textSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\n\n  // To make all text properly sized, we calculate the transformation matrix of the element.\n  // It is very important that the element is in the DOM (see (1))\n  // Otherwise, getScreenCTM returns null\n  const matrix = textEle.getScreenCTM()\n\n  if (!matrix) return\n\n  // Then we undo the scaling We're only using `a`, so we're assuming that the element is not skewed and scale uniformly ...\n  // FIXME later?\n  // a c e\n  // b d f\n  // 0 0 1\n\n  const scale = 1 / matrix.a\n\n  textSvg.dataset.textX = textEle.getAttribute('x') || undefined\n  textSvg.dataset.textY = textEle.getAttribute('y') || undefined\n  textSvg.dataset.scale = String(scale)\n\n  const textContentToId = (textContent: string) =>\n    textContent.replace(/[^a-zA-z]+/g, '')\n\n  textSvg.id = textContentToId(text)\n\n  // Finally, we replace the text node with the svg.\n  textEle.parentNode!.replaceChild(textSvg, textEle)\n\n  await animate(textSvg, text, true, 0, ({ width, height, viewBox }) => {\n    textSvg.setAttribute('width', width + 'pt')\n    textSvg.setAttribute('height', height + 'pt')\n    textSvg.setAttribute('viewBox', viewBox.join(' '))\n    positionSvg(textSvg)\n  })\n}\n\nconst TIMING = 0.4\n\n// make awaitable?\nfunction update(\n  wrapper: HTMLDivElement,\n  step: any,\n  replaceImediately: boolean\n) {\n  for (const key in step) {\n    if (step[key] === null || step[key] === undefined) {\n      continue\n    }\n    if (key.startsWith('text:')) {\n      const id = key.replace(/^text:/, '')\n      const textSvg = wrapper.querySelector(`svg#${id}`) as SVGSVGElement\n      if (textSvg) {\n        if (replaceImediately) {\n          // remove the placeholder of the text\n          textSvg.innerHTML = ''\n        }\n        // TODO: use that animation groups database!\n        animate(\n          textSvg,\n          step[key] || '',\n          replaceImediately,\n          0.3,\n          ({ width, height, viewBox }) => {\n            textSvg.setAttribute('width', width + 'pt')\n            textSvg.setAttribute('height', height + 'pt')\n            textSvg.setAttribute('viewBox', viewBox.join(' '))\n            positionSvg(textSvg)\n          }\n        )\n      }\n    } else {\n      const ele = wrapper.querySelector(`#${key}`) as SVGElement\n      const { css = {}, ...rest } = step[key]\n      if (ele) {\n        for (const key in css) {\n          ele.style[key as any] = (css as { [index: string]: any })[key]\n        }\n\n        if (replaceImediately) {\n          gsap.set(ele, { ...rest })\n        } else {\n          console.log('timing is ', rest.seconds, TIMING)\n          gsap.to(ele, {\n            duration: rest.seconds || TIMING,\n            ...rest\n          })\n        }\n      }\n    }\n  }\n}\n\n// Cache the images\nconst memoizedFetch = memoize(\n  (src: string): Promise<string> => fetch(src).then((r) => r.text())\n)\n\ntype AnimateSVGStep = {\n  css?: React.CSSProperties\n  [key: string]: any\n}\n\ntype AnimateSVGProps = {\n  src: string\n  step: AnimateSVGStep\n  width: string | number\n  height: string | number\n}\n\nfunction AnimateSVG({\n  src,\n  step = {},\n  width = '100%',\n  height = 'auto'\n}: AnimateSVGProps): React.ReactNode {\n  const element = useRef<HTMLDivElement | null>(null)\n  useEffect(() => {\n    ;(async () => {\n      // Load the svg\n      const text = await memoizedFetch(src)\n      const div = element.current\n      if (!div) return\n\n      div.style.opacity = '0'\n      // (1)\n      div.innerHTML = text\n      div.querySelector('svg')!.style.width = width as string\n      div.querySelector('svg')!.style.height = height as string\n\n      // Replace text\n      await Promise.all(\n        Array.from(div.querySelectorAll('text')).map(async (textEle) => {\n          if (textEle.matches('.dont-replace *')) {\n            return\n          }\n\n          // Simply <text></text>\n          if (textEle.children.length === 0) {\n            await replaceText(textEle)\n          } else {\n            // Text of the form <text><tspan></tspan> ... <tspan></tspan></text>\n            const g = document.createElementNS(\n              'http://www.w3.org/2000/svg',\n              'g'\n            )\n\n            // replace text\n            await Promise.all(\n              Array.from(textEle.children).map((el) =>\n                replaceText(el as SVGGraphicsElement)\n              )\n            )\n            // Put the svgs from the replaced text in a group\n            Array.from(textEle.children).forEach((e) => g.appendChild(e))\n\n            // Replace <text><tspan/><tspan/>...</text> element with <g><svg/><svg/>...</g>\n            textEle.parentNode!.replaceChild(g, textEle)\n          }\n        })\n      )\n\n      // Set the correct opacity, ... of the elements\n      if (element.current) {\n        update(element.current, step, true)\n      }\n\n      // Fade in the picture\n      div.style.transition = '0.3s opacity'\n      div.style.opacity = '1'\n    })()\n  }, [element.current])\n\n  // When the step changes, animate the new opacities\n  useEffect(() => {\n    if (!element.current) return\n\n    update(element.current, step, false)\n  }, [step, element])\n\n  return (\n    <div\n      ref={element}\n      style={{\n        margin: '-1rem'\n      }}\n    />\n  )\n}\n\nexport default AnimateSVG\n","import React from 'react'\n\nimport Morph from './Morph'\n\nexport function InlineMath({\n  children,\n  ...props\n}: {\n  children: string\n  [key: string]: any\n}): React.ReactElement {\n  return (\n    <Morph inline replace {...props}>\n      {children}\n    </Morph>\n  )\n}\n\nexport function DisplayMath({\n  children,\n  ...props\n}: {\n  children: string\n  [key: string]: any\n}): React.ReactElement {\n  return (\n    <Morph display replace {...props}>\n      {children}\n    </Morph>\n  )\n}\n\nexport const m = (\n  template: TemplateStringsArray,\n  ...subtitutions: any[]\n): React.ReactElement => (\n  <InlineMath>{String.raw(template, ...subtitutions)}</InlineMath>\n)\nexport const M = (\n  template: TemplateStringsArray,\n  ...subtitutions: any[]\n): React.ReactElement => (\n  <DisplayMath>{String.raw(template, ...subtitutions)}</DisplayMath>\n)\n","import React, { useEffect, useState } from 'react'\n\ntype Size = {\n  width: number\n  height: number\n}\n// TODO: rename this\nfunction measureText(text: string, style: React.CSSProperties = {}): Size {\n  const div = document.createElement('div')\n\n  document.body.appendChild(div)\n  div.style.position = 'absolute'\n  div.style.left = '-1000'\n  div.style.top = '-1000'\n  for (const key in style) {\n    div.style[key as any] = (style as { [index: string]: any })[key]\n  }\n\n  // TODO: this assumes text!\n  div.innerHTML = text\n\n  const result = {\n    width: div.clientWidth,\n    height: div.clientHeight\n  }\n\n  document.body.removeChild(div)\n\n  return result\n}\n\nfunction MObject({ children }: { children: string }): React.ReactElement {\n  const [child, setChild] = useState<string | null>(null)\n  const [opacity, setOpacity] = useState<number>(1)\n  const [width, setWidth] = useState<number>(0)\n\n  useEffect(() => {\n    setOpacity(0)\n    setWidth(measureText(children).width)\n    setTimeout(() => setChild(children), 500)\n    setTimeout(() => setOpacity(1), 500)\n  }, [children])\n\n  return (\n    <div\n      style={{\n        opacity,\n        display: 'inline-block',\n        transition: '0.5s opacity, 0.7s width',\n        width: width,\n        overflow: 'hidden',\n        verticalAlign: 'top'\n      }}\n    >\n      {child}\n    </div>\n  )\n}\n\nexport default MObject\n","import React, { useRef, useEffect, useContext } from 'react'\n\nimport useResizeObserver from 'use-resize-observer'\n\nimport {\n  PresentationContext,\n  PresentationContextInterface,\n  Transitions\n} from './Presentation'\n\ntype Rect = {\n  left: number\n  top: number\n  width: number\n  height: number\n  parentWidth: number\n  parentHeight: number\n}\n\ntype Portal = {\n  zoom: 'in' | 'out' | null\n  rect: Rect\n}\n\nfunction getRect(element: HTMLElement): Rect {\n  let el = element\n  let offsetLeft = 0\n  let offsetTop = 0\n\n  do {\n    offsetLeft += el.offsetLeft // + el.clientLeft;\n    offsetTop += el.offsetTop // + el.clientTop;\n\n    el = el.offsetParent as HTMLElement\n  } while (!el.classList.contains('slide'))\n  return {\n    left: offsetLeft,\n    top: offsetTop,\n    width: element.offsetWidth,\n    height: element.offsetHeight,\n    parentWidth: el.offsetWidth,\n    parentHeight: el.offsetHeight\n  }\n}\n\nconst addPortal = (\n  { i, setTransitions }: PresentationContextInterface,\n  portal: Portal\n): void => {\n  const {\n    rect: { width, height, left, top, parentWidth, parentHeight }\n  } = portal\n  const sx = parentWidth / width\n  const sy = parentHeight / height\n\n  const s = Math.max(sx, sy)\n\n  const x = left\n  const y = top\n\n  const enlarge: React.CSSProperties = {\n    transformOrigin: `${x + width / 2}px ${y + height / 2}px`,\n    transform: `translate3d(${-(x + width / 2) + parentWidth / 2}px, ${\n      -(y + height / 2) + parentHeight / 2\n    }px, 0px) scaleX(${s}) scaleY(${s})`,\n    opacity: 0\n  }\n\n  const shrink: React.CSSProperties = {\n    transformOrigin: `${parentWidth / 2}px ${parentHeight / 2}px`,\n    transform: `translate3d(${-parentWidth / 2 + x + width / 2}px, ${\n      -parentHeight / 2 + y + height / 2\n    }px, 0px) scaleX(${1 / s}) scaleY(${1 / s})`,\n    opacity: 0\n  }\n\n  setTransitions(\n    (transitions: Transitions): Transitions => {\n      const newTransitions = { ...transitions }\n      if (portal.zoom === 'in') {\n        newTransitions[i] = {\n          ...(newTransitions[i] || {}),\n          after: enlarge\n        }\n        newTransitions[i + 1] = {\n          ...(newTransitions[i + 1] || {}),\n          before: shrink\n        }\n      }\n\n      // Problem: if out and in: current transformOrigin gets set twice!\n      // FIXME\n      if (portal.zoom === 'out') {\n        newTransitions[i - 1] = {\n          ...(newTransitions[i - 1] || {}),\n          after: shrink\n        }\n        newTransitions[i] = {\n          ...(newTransitions[i] || {}),\n          before: enlarge\n        }\n      }\n      return newTransitions\n    }\n  )\n}\n\ntype PortalProps = {\n  children: React.ReactNode\n  zoomin?: boolean\n  zoomout?: boolean\n  [key: string]: any\n}\n\nexport default function Portal({\n  children,\n  zoomin,\n  zoomout,\n  className = '',\n  ...props\n}: PortalProps): React.ReactNode {\n  const context = useContext(PresentationContext)\n  const zoom = zoomin ? 'in' : zoomout ? 'out' : null\n\n  const ref = useRef<HTMLDivElement | null>(null)\n  useResizeObserver({\n    ref,\n    onResize: () => {\n      if (!zoom) return\n      if (!ref.current) return\n      if (!context) return\n      const rect = getRect(ref.current)\n      addPortal(context, { zoom, rect })\n    }\n  })\n\n  return (\n    <div className={`inline-block ${className}`} ref={ref} {...props}>\n      {children}\n    </div>\n  )\n}\n","import { range } from './utils'\n\nconst defaultTranslations: { [key: string]: any } = {\n  _: '',\n  h: { opacity: 0 },\n  v: { opacity: 1 },\n  p: { opacity: 0.3 },\n  d: { drawSVG: 0 },\n  D: { drawSVG: '0 100%' },\n  x: true\n}\n\nconst timeline = (\n  strings: TemplateStringsArray,\n  ...subs: any[]\n): { [key: string]: any }[] => {\n  const translate = (sub: any) => (s: string | number): any =>\n    Object.prototype.hasOwnProperty.call(sub, s)\n      ? sub[s]\n      : Object.prototype.hasOwnProperty.call(defaultTranslations, s)\n      ? defaultTranslations[s]\n      : s\n\n  const fillWithLastUntilHasLength = (array: any[], length: number) => {\n    const last = array[array.length - 1]\n    return [\n      ...array,\n      ...Array.from({ length: length - array.length }).map(() => last)\n    ]\n  }\n\n  const lines = strings.flatMap((part: string, i: number): {\n    text: string\n    sub: any\n  }[] => {\n    const lines = part.split('\\n').filter((line) => line.trim() !== '')\n    if (lines.length === 0) return []\n    const firsts = lines.slice(0, lines.length - 1)\n    const last = lines[lines.length - 1]\n\n    return [\n      ...firsts.map((l) => ({ text: l, sub: {} })),\n      { text: last, sub: subs[i] }\n    ]\n  })\n\n  const charactersInterpreted = lines\n    .map(({ text, sub }) => {\n      const trimmed = text.trim()\n      const splitted = trimmed.split(/\\s+(.+)/)\n\n      return {\n        label: splitted[0],\n        text: splitted[1],\n        sub: sub\n      }\n    })\n    .map(({ label, sub, text }) => {\n      const numbers: (string | number | number[])[] = []\n      let number = 0\n\n      text.split('').forEach((step, i) => {\n        const prev = numbers[numbers.length - 1]\n        const nextChar = text[i + 1]\n\n        if (step === ' ') {\n          numbers.push(prev)\n          return\n        }\n        if (step === '+' || step === '-') {\n          if (step === '+') {\n            number += 1\n          } else {\n            number -= 1\n          }\n          numbers.push(number)\n          return\n        }\n\n        if (step === '.') {\n          if (Array.isArray(prev)) {\n            throw new Error(\n              'Cannot use a dot . in a timeline specification immediately following another dot'\n            )\n          }\n          if (typeof prev === 'string') {\n            throw new Error(\n              'Cannot use a dot . if it is surrounded by non-numbers'\n            )\n          }\n          if (isNaN(prev)) return\n\n          let to: number\n          if (nextChar && !isNaN(parseInt(nextChar))) {\n            to = parseInt(nextChar)\n          } else {\n            to = sub.length\n          }\n\n          const rangeInBetween = range(to - prev - 1).map((n) => n + prev + 1)\n\n          if (rangeInBetween.length === 0) {\n            numbers.push(prev)\n            return\n          }\n\n          numbers.push(rangeInBetween)\n          return\n        }\n\n        const n = parseInt(step)\n        if (!isNaN(n)) {\n          number = n\n          numbers.push(number)\n          return\n        }\n        numbers.push(step)\n      })\n      return { label, numbers, sub }\n    })\n\n  const numberOfUnexpandedSteps = Math.max(\n    ...charactersInterpreted.map((obj) => obj.numbers.length)\n  )\n\n  const expanded = charactersInterpreted.map(({ label, numbers, sub }) => {\n    const expandedSteps = range(numberOfUnexpandedSteps).flatMap((index) => {\n      const length = Math.max(\n        ...charactersInterpreted.map(({ numbers }) => {\n          const element = numbers[index]\n          if (Array.isArray(element)) {\n            return element.length\n          } else {\n            return 1\n          }\n        })\n      )\n\n      let numberOrNumbers\n\n      if (numbers[index] !== undefined) {\n        numberOrNumbers = numbers[index]\n      } else {\n        const last = numbers[numbers.length - 1]\n        if (Array.isArray(last)) {\n          numberOrNumbers = last[last.length - 1]\n        } else {\n          numberOrNumbers = last\n        }\n      }\n\n      if (Array.isArray(numberOrNumbers)) {\n        return fillWithLastUntilHasLength(numberOrNumbers, length)\n      } else {\n        return fillWithLastUntilHasLength([numberOrNumbers], length)\n      }\n    })\n\n    return {\n      label,\n      translated: expandedSteps.map(translate(sub || {}))\n    }\n  })\n\n  const output = range(expanded[0].translated.length).map((stepIndex) => {\n    return Object.fromEntries(\n      expanded.map(({ label, translated }) => [label, translated[stepIndex]])\n    )\n  })\n\n  return output\n}\n\nexport default timeline\n","import './external/tailwind.min.css'\nimport './index.css'\nimport * as modern from './themes/modern'\n\nconst themes = {\n  modern\n}\n\nexport { default as AnimateSVG } from './AnimateSVG'\nexport { default as Show } from './Show'\nexport { InlineMath, DisplayMath, m, M } from './LaTeX'\nexport { default as MObject } from './MObject'\nexport { default as Portal } from './Portal'\n// Presentation.js\nexport { default as Notes } from './PresenterNotes'\nexport { range } from './utils'\nexport { default as timeline } from './timeline'\nexport { default as Morph } from './Morph'\nexport { themes }\n"],"names":["CitationContext","React","createContext","CitationProvider","bibUrl","citationMap","children","useState","bibliography","setBibliography","useEffect","fetch","then","res","text","result","Citation","parse","bibtex","Provider","value","RenderCite","id","render","useContext","find","e","label","format","template","lang","number","RenderBibliography","sortedEntries","Object","entries","sort","a","b","map","n","entry","html","Notes","global","freeGlobal","Symbol","root","objectProto","nativeObjectToString","symToStringTag","getRawTag","objectToString","isObjectLike","baseGetTag","hasOwnProperty","baseIsArguments","isArray","isArguments","isFlattenable","arrayPush","baseFlatten","range","Array","from","keys","queryParameters","obj","key","encodeURIComponent","join","cacheBust","LaTeX","_preamble","_host","window","location","hostname","getHost","setHost","h","getPreamble","setPreamble","p","normalizeLaTeXPreamble","fetchSVG","tex","cachebust","preamble","ok","Error","split","line","trim","filter","elementToPath","child","transform","ownerSVGElement","svg","tagName","offsetX","parseFloat","getAttribute","offsetY","element","querySelector","console","error","path","pathParse","relNormalize","err","segments","type","newPath","serializePath","tr","x","y","width","height","pathData","groupIdFromElement","fill","slice","svgToGroupedPaths","byGroupId","getElementById","subchild","Boolean","colorHash","str","String","hash","i","length","charCodeAt","colour","toString","substr","toUpperCase","fetchLaTeXSvg","memoize","ele","document","createElement","innerHTML","groups","viewBox","replace","s","log","_","p1","usePrevious","ref","useRef","current","useLocalStorage","initialValue","item","localStorage","getItem","JSON","storedValue","setStoredValue","setValue","valueToStore","Function","setItem","stringify","animate","svgEl","replaceImediately","TIMING","setSvgData","DEFAULT_TIMING","undefined","data","newPaths","afterIds","beforeIds","querySelectorAll","allIds","Set","Promise","all","setAttribute","style","opacity","gsap","to","duration","morphSVG","isNew","createElementNS","color","colorFromGroupId","whiteListedColors","includes","appendChild","shouldRemove","remove","registerPlugin","MorphSVGPlugin","DrawSVGPlugin","allColors","convertToTeX","selections","c","ending","starting","col","lookupAnimationGroups","start","end","animationGroups","startGroups","endGroups","AnimationEditor","playedAnimations","animations","setAnimations","colorIndex","setColorIndex","onKeyPress","parseInt","addEventListener","removeEventListener","newOnes","animation","animated","inDataBase","anim","animationsIShouldShow","useMemo","index","findIndex","array","className","backgroundColor","onClick","Animation","setAnimation","f","handleSelection","useCallback","sel","getSelection","anchorNode","focusNode","sString","parentNode","dataset","eString","anchorOffset","focusOffset","part1","part","part2","Math","min","max","newAnimation","mergeSelections","removeAllRanges","handleClick","ev","button","target","determineSelections","activeSelection","preventDefault","group","splitChars","fontFamily","onMouseUp","onContextMenu","j","background","AutoMorph","steps","step","setStep","Morph","display","useAnimationDatabase","colors","levels","forEach","_c","currentActive","push","prev","_s","surrounding","wrapMathBasedOnProps","props","inline","debug","vx","vy","vw","vh","transition","setTransition","FONT_SCALING_FACTOR","updateSvgData","wrapMath","previousChildren","useLayoutEffect","promise","resolve","update","before","after","inner","left","marginTop","marginRight","verticalAlign","position","outline","top","flexGrow","margin","Fragment","withFakeDispatcher","ctx","cb","ReactCurrentDispatcher","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","original","context","readContext","useImperativeHandle","useReducer","initialState","initial","useDebugValue","useResponder","useDeferredValue","useTransition","isComponent","node","ignore","findElementsInTree","predicate","found","handleTree","resolved","childs","flattenDeep","getPropsRecursiveUntilSlideComponentIsEncountered","RenderSlide","slide","rest","getSlidesInfo","slides","mockContextes","PresentationContext","slideIndex","slidesInfo","info","slideWithProps","infos","accumulatedInfo","newInfo","sectionSlide","section","hideNavigation","header","getCitations","presenterNotes","tree","notes","note","allLaTeX","morphs","defaultResult","_source","contents","formulas","formula","startGrouped","endGrouped","trees","cite","values","RenderPresentation","Router","Switch","Route","exact","Storage","PresentationUI","presenter","fullscreen","PresentationOverview","compileHost","reactSlides","Children","toArray","match","useRouteMatch","history","useHistory","useParams","slideIndexString","stepIndex","stepIndexString","transitions","setTransitions","bc","BroadcastChannel","onmessage","event","setSlideAndStep","notify","generatePath","postMessage","getNext","getPrev","dontStepButGoToPrevSlide","next","dontStepButGoToNextSlide","handleKey","Clock","transformOrigin","marginBottom","wrappedSlides","threeSlides","Tabs","Tab","show","setShow","flatMap","_step","hasSteps","call","setStyle","updateStyle","zIndex","content","whiteSpace","Show","when","realStyle","isValidElement","cloneElement","Presentation","w","overflow","Slide","slideStyle","bottom","right","borderRadius","SectionSlide","numSlides","ConclusionSlide","TitleSlide","title","names","names2","date","TableOfContentsSlide","sections","v","indexOf","QuestionSlide","Figure","caption","List","childArray","Item","name","listStyle","Cite","hidden","BibliographySlide","stride","items","ceil","dangerouslySetInnerHTML","__html","Box","smallTitle","Qed","positionSvg","textSvg","scaleString","scale","textXString","textX","textYString","textY","replaceText","textEle","textContent","matrix","getScreenCTM","textContentToId","replaceChild","wrapper","startsWith","css","set","seconds","memoizedFetch","src","r","AnimateSVG","div","matches","g","el","InlineMath","DisplayMath","m","subtitutions","raw","M","measureText","body","clientWidth","clientHeight","removeChild","MObject","setChild","setOpacity","setWidth","setTimeout","getRect","offsetLeft","offsetTop","offsetParent","classList","contains","offsetWidth","offsetHeight","parentWidth","parentHeight","addPortal","portal","rect","sx","sy","enlarge","shrink","newTransitions","zoom","Portal","zoomin","zoomout","useResizeObserver","onResize","defaultTranslations","d","drawSVG","D","timeline","strings","subs","translate","sub","prototype","fillWithLastUntilHasLength","last","lines","firsts","l","charactersInterpreted","trimmed","splitted","numbers","nextChar","isNaN","rangeInBetween","numberOfUnexpandedSteps","expanded","expandedSteps","numberOrNumbers","translated","output","fromEntries","themes","modern"],"mappings":"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"}